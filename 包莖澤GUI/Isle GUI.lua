repeat wait() until game:IsLoaded() and game.Players and game.Players.LocalPlayer and game.Players.LocalPlayer.Character or (game.placeId == 10098525303 and game:IsLoaded())
if game.GameId ~= 1116949753 then return end


getgenv().Settings = {
    ItemESP = false,
    ItemESPDistance = 5000,
    WalkSpeed = 16,
}

--[變數]--[變數]--[變數]--[變數]--[變數]--[變數]--[變數]--

--[服務]：
local players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
--[簡寫]：
local guiName = "Isle GUI v0.1"
local settingdata = "houkei_gui/Isle.json"
local localplayer = players.LocalPlayer
local PlayerGui = localplayer.PlayerGui
--[空變數]：
local OldSettings
local uuid
local UnitName
local RecordFileName
--[布林值]：
local FirstDiscordAlert = true
--[空陣列]：
local RecordFile = {}

--[變數]--[變數]--[變數]--[變數]--[變數]--[變數]--[變數]--


function CheckData(DataName)
    if OldSettings[DataName] == nil then
        print(DataName .. "值:缺失")
        OldSettings[DataName] = getgenv().Settings[DataName]
        print(DataName .. "值:已補上")
    else
        print(DataName .. "值:存在")
    end
end

print("[檢查「Isle GUI」設定檔完整性...]")

--[檢查資料夾
if isfolder("houkei_gui") then--有houkei資料夾
    print("houkei資料夾:存在")
else
    makefolder("houkei_gui")
end
--檢查資料夾]


if isfile(settingdata) then--有Isle.json
    print("Isle.json:存在")
    --[導入OldSettings
    OldSettings = HttpService:JSONDecode(readfile(settingdata))
    --導入OldSettings]
    --[檢查Isle.json完整性

    CheckData("ItemESP")

    CheckData("ItemESPDistance")

    CheckData("WalkSpeed")

    --檢查Isle.json完整性]
    --[導入OldSettings到getgenv().Settings
    getgenv().Settings = OldSettings
    print("設定檔導入成功！")
    print("[檢查「盜版全明星塔防GUI」設定檔完整性:完成]")
    --導入OldSettings到getgenv().Settings]
else
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end

--[檢查完檔案後才能跑 GUI library
local library = loadstring(game:HttpGet(("https://raw.githubusercontent.com/kakuun333/Exploit_Scripts/main/%E5%8C%85%E8%8E%96%E6%BE%A4GUI/GUI-Library/%E5%8C%85%E8%8E%96%E6%BE%A4GUI-Library.lua")))()
--檢查完檔案後才能跑 GUI library]

--------------------------------------[函數

function ItemESP()
    local ItemFolder = workspace.Map.Ignore.Tools

    local camera = workspace.CurrentCamera

    local HeadOff = Vector3.new(0, 0.5, 0)
    local LegOff = Vector3.new(0,1,0)
    local BoxDown = Vector3.new(0,3,0)

    function getDistance(part)
        return (part.Position - camera.CFrame.Position).Magnitude
    end

    function esp(Item)
        local ItemHandle = Item:WaitForChild("Handle")
        local ItemNameText = Drawing.new("Text")
        ItemNameText.Visible = false
        ItemNameText.Center = true
        ItemNameText.Outline = true
        ItemNameText.Color = Color3.fromRGB(255,255,255)
        ItemNameText.Font = 3
        ItemNameText.Size = 20
        ItemNameText.ZIndex = 0
        ItemNameText.Transparency = 0.7

        local Box = Drawing.new("Square")
        Box.Visible = false
        Box.Color = Color3.fromRGB(255,255,255)
        Box.Thickness = 1
        Box.Transparency = 1
        Box.Filled = false
        

        local renderstepped
        renderstepped = game:GetService("RunService").RenderStepped:Connect(function()
            if Item:FindFirstChild("Handle") and getgenv().Settings.ItemESP == true then
                
                local ItemPos, ItemOnscreen = camera:WorldToViewportPoint(ItemHandle.Position - BoxDown)

                local TorsoPosition = camera:WorldToViewportPoint(ItemHandle.Position)
                local HeadPosition = camera:WorldToViewportPoint(ItemHandle.Position + HeadOff)
                local LegPosition = camera:WorldToViewportPoint(ItemHandle.Position - LegOff)

                if ItemOnscreen and getDistance(ItemHandle) < getgenv().Settings.ItemESPDistance then

                    ItemNameText.Position = Vector2.new(ItemPos.X, ItemPos.Y)
                    ItemNameText.Visible = true
                    ItemNameText.Text = Item.Name .. "[" .. math.floor(getDistance(ItemHandle)) .. "]"
                    
                    Box.Size = Vector2.new(1500 / TorsoPosition.Z, HeadPosition.Y - LegPosition.Y)
                    Box.Position = Vector2.new(TorsoPosition.X - Box.Size.X / 2, TorsoPosition.Y - Box.Size.Y / 2)
                    Box.Visible = true
                else
                    Box.Visible = false
                    ItemNameText.Visible = false
                end
            else
                Box.Visible = false
                Box:Remove()
                
                ItemNameText.Visible = false
                ItemNameText:Remove()
                
                renderstepped:Disconnect()
            end
        end)
    end

    for i,Item in next, ItemFolder:GetChildren() do
        local ItemHandle = Item:WaitForChild("Handle")
        if Item ~= nil and ItemHandle ~= nil and getgenv().Settings.ItemESP == true then
            esp(Item)
        end
    end

    ItemFolder.ChildAdded:Connect(function(Item)
        if getgenv().Settings.ItemESP == true then
            esp(Item)
        end
    end)
end

function antiAFK()
    repeat wait() until game:IsLoaded()
    spawn(function()
        while wait(60) do
            game:GetService("VirtualUser"):ClickButton2(Vector2.new())
        end
    end)
    print("反AFK測試腳本已載入")
end

function WalkSpeed()
    if not getgenv().MTAPIMutex then loadstring(game:HttpGet("https://raw.githubusercontent.com/KikoTheDon/MT-Api-v2/main/__source/mt-api%20v2.lua", true))() end
    local players = game:GetService("Players")
    local humanoid = players.LocalPlayer.Character.Humanoid
    humanoid:AddPropertyEmulator("WalkSpeed")
    humanoid:AddPropertyEmulator("JumpPower")
    
    --[[調整速度]]--
    getgenv().Speed = getgenv().Settings.WalkSpeed
    
    while wait(0.01) do
        humanoid.WalkSpeed = getgenv().Speed
    end
end
--------------------------------------函數]


local Main = library:MainFrame(guiName)


local ingameTab = Main:Tab("遊戲內")

local performanceTab = Main:Tab("效能")

Main:ZoomWindow(function(bool)
    getgenv().Settings.ZoomWindow = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end):Set(getgenv().Settings.ZoomWindow)

ingameTab:Toggle("物品透視",function(bool)
    getgenv().Settings.ItemESP = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.ItemESP then
        spawn(ItemESP)
    end
end):Set(getgenv().Settings.ItemESP)

ingameTab:Slider("物品透視距離",1,5000,function(arg)
    getgenv().Settings.ItemESPDistance = arg
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))  
end):Set(getgenv().Settings.ItemESPDistance)

ingameTab:Slider("跑速",1,250,function(arg)
    getgenv().Settings.WalkSpeed = arg
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))  
end):Set(getgenv().Settings.WalkSpeed)

-- ---------------------------------------------------------------------------------------------

-- lobbyTab:Tag("傳送")


-- lobbyTab:ToggleDropdown("傳送關卡",levelListCN,
-- function(SelectedLevel)
--     getgenv().Settings.SelectedLevel = SelectedLevel
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
--     if getgenv().Settings.TPLevel then
--         spawn(TPLevel)
--     end
-- end,
-- function(bool)
--     getgenv().Settings.TPLevel = bool
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
--     if getgenv().Settings.TPLevel then
--         spawn(TPLevel)
--     end
-- end):Set(getgenv().Settings.SelectedLevel,getgenv().Settings.TPLevel)

-- performanceTab:Tag("降低CPU使用率")

-- performanceTab:Toggle("關閉3D渲染",function(bool)
--     getgenv().Settings.WindowFocus = bool
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
--     if getgenv().Settings.WindowFocus then
--         -- local RENDER = true
--         -- local UserInputService = game:GetService("UserInputService")
--         local RunService = game:GetService("RunService")
--         RunService:Set3dRenderingEnabled(false)
--     else
--         local RunService = game:GetService("RunService")
--         RunService:Set3dRenderingEnabled(true)
--         -- WindowFocused = UserInputService.WindowFocused:Connect(function()
--         --     if RENDER then
--         --         RunService:Set3dRenderingEnabled(true)
--         --     end
--         -- end)

--         -- WindowFocusReleased = UserInputService.WindowFocusReleased:Connect(function()
--         --     if RENDER then
--         --         RunService:Set3dRenderingEnabled(false)
--         --     end
--         -- end)
--     end
-- end):Set(getgenv().Settings.WindowFocus)
