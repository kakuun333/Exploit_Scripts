--[[

  \\\\\\\\\\      盜版全明星塔防GUI      //////////
   \\\\\\\\\\     盜版全明星塔防GUI     //////////
    \\\\\\\\\\    盜版全明星塔防GUI    //////////
     \\\\\\\\\\   盜版全明星塔防GUI   //////////
      \\\\\\\\\\  盜版全明星塔防GUI  //////////
       \\\\\\\\\\ 盜版全明星塔防GUI //////////
        \\\\\\\\\\盜版全明星塔防GUI//////////
        //////////盜版全明星塔防GUI\\\\\\\\\\
       ////////// 盜版全明星塔防GUI \\\\\\\\\\
      //////////  盜版全明星塔防GUI  \\\\\\\\\\
     //////////   盜版全明星塔防GUI   \\\\\\\\\\
    //////////    盜版全明星塔防GUI    \\\\\\\\\\
   //////////     盜版全明星塔防GUI     \\\\\\\\\\
  //////////      盜版全明星塔防GUI      \\\\\\\\\\

]]
repeat wait() until game:IsLoaded() and game.Players and game.Players.LocalPlayer and game.Players.LocalPlayer.Character or (game.placeId == 10098525303 and game:IsLoaded())
if game.GameId ~= 3183403065 then return end


getgenv().Settings = {
    votestart = false,
    autoupgrade = false,
    backtolobby = false,
    ClaimQuest = false,
    antiAFK = false,
    tptoAFK = false,
    ClaimDailyReward = false,
    DeletePlaceHitbox = false,
    Record = false,
    Playback = false,
    AutoToNamek = false,
    DiscordAlert = false,
    BoostFPS = false,
    WindowFocus = false,
    TPLevel = false,
    unit1 = {"UnitName","uuid"},
    unit2 = {"UnitName","uuid"},
    unit3 = {"UnitName","uuid"},
    unit4 = {"UnitName","uuid"},
    unit5 = {"UnitName","uuid"},
    unit6 = {"UnitName","uuid"},
    SelectedRecordFile = "選擇錄製檔",
    SelectedLevel = "",
    SellUnitWave = 250,
    TotalGem = 0,
    TotalGold = 0,
    TotalXP = 0,

}

--[變數]--[變數]--[變數]--[變數]--[變數]--[變數]--[變數]--

--[服務]：
local players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
--[簡寫]：
local guiName = "盜版全明星塔防GUI v0.14"
local settingdata = "houkei_gui/FakeAllStar.json"
local localplayer = players.LocalPlayer
local PlayerGui = localplayer.PlayerGui
local client_to_server = ReplicatedStorage.endpoints["client_to_server"]
--[空變數]：
local OldSettings
local uuid
local UnitName
local RecordFileName
--[布林值]：
local FirstDiscordAlert = true
--[空陣列]：
local RecordFile = {}
local levelList = {
    "namek_level_1",
    "namek_level_2",
    "namek_level_3",
    "namek_level_4",
    "namek_level_5",
    "namek_level_6",
    "namek_infinite",

    "aot_level_1",
    "aot_level_2",
    "aot_level_3",
    "aot_level_4",
    "aot_level_5",
    "aot_level_6",
    "aot_infinite",

}
--[陣列]：

--[變數]--[變數]--[變數]--[變數]--[變數]--[變數]--[變數]--


function CheckData(DataName)
    if OldSettings[DataName] == nil then
        print(DataName .. "值:缺失")
        OldSettings[DataName] = getgenv().Settings[DataName]
        print(DataName .. "值:已補上")
    else
        print(DataName .. "值:存在")
    end
end


print("[檢查「盜版全明星塔防GUI」設定檔完整性...]")

--[檢查資料夾
if isfolder("houkei_gui") then--有houkei資料夾
    print("houkei資料夾:存在")
else
    makefolder("houkei_gui")
end

if isfolder("houkei_gui/錄製檔") then
    print("錄製檔資料夾:存在")
else
    makefolder("houkei_gui/錄製檔")
end
--檢查資料夾]


if isfile(settingdata) then--有FakeAllStar.json
    print("FakeAllStar.json:存在")
    --[導入OldSettings
    OldSettings = HttpService:JSONDecode(readfile(settingdata))
    --導入OldSettings]
    --[檢查FakeAllStar.json完整性
    CheckData("votestart")

    CheckData("autoupgrade")

    CheckData("backtolobby")

    CheckData("ClaimQuest")

    CheckData("antiAFK")

    CheckData("tptoAFK")

    CheckData("ClaimDailyReward")

    CheckData("unit1")

    CheckData("unit2")

    CheckData("unit3")

    CheckData("unit4")

    CheckData("unit5")

    CheckData("unit6")

    CheckData("DeletePlaceHitbox")

    CheckData("Record")

    CheckData("Playback")

    CheckData("SelectedRecordFile")

    CheckData("AutoToNamek")

    CheckData("SellUnitWave")

    CheckData("TotalGem")

    CheckData("TotalGold")

    CheckData("TotalXP")

    CheckData("DiscordAlert")

    CheckData("BoostFPS")

    CheckData("WindowFocus")

    CheckData("SelectedLevel")

    CheckData("TPLevel")

    --檢查FakeAllStar.json完整性]
    --[導入OldSettings到getgenv().Settings
    getgenv().Settings = OldSettings
    print("設定檔導入成功！")
    print("[檢查「盜版全明星塔防GUI」設定檔完整性:完成]")
    --導入OldSettings到getgenv().Settings]
else
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end

getgenv().RecordFileList = listfiles("houkei_gui/錄製檔")


spawn(function()
    while wait(1.5) do
        getgenv().RecordFileList = listfiles("houkei_gui/錄製檔")
    end
end)

--[檢查完檔案後才能跑 GUI library
local library = loadstring(game:HttpGet(("https://gist.githubusercontent.com/kakuun333/8d81d55e2c6fe0d68d4372d7fb224757/raw/cf9442de56f834f375aa4d141ae59bef773d4d76/%25E5%258C%2585%25E8%258E%2596%25E6%25BE%25A4GUI-Library.lua")))()
--檢查完檔案後才能跑 GUI library]

--------------------------------------[函數

function stringtocframe(str)
    return CFrame.new(table.unpack(str:gsub(" ",""):split(",")))
end

function votestart()
    if game.placeId == 10098525303 then return end
    while getgenv().Settings.votestart do
        if game:GetService("Workspace")["_DATA"].VoteStart.VotingFinished.Value == false then
            client_to_server["vote_start"]:InvokeServer()
        end
        wait()
    end
end

function autoupgrade()
    if getgenv().Settings.autoupgrade then
        if game.placeId == 10098525303 then return end
        local messages = PlayerGui.MessageGui.messages
        messages.UIListLayout.SortOrder = Enum.SortOrder.Name
        messages.UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
        messages.ChildAdded:Connect(function(child)
            if child:IsA("Frame") and child.Name == "Error" and child:WaitForChild("Tex").Text == "Not enough money!" then
                child.Tex.Text = ""
                repeat wait() until child.UIScale
                child:Destroy()
            end
        end)
    end
    while getgenv().Settings.autoupgrade do
        for i,v in next, game:GetService("Workspace")["_UNITS"]:GetDescendants() do
            if v:IsA("ObjectValue") and v.Name == "player" then
                if v.Value == localplayer then
                    local unit = v.Parent.Parent
                    local Target = client_to_server["upgrade_unit_ingame"]
                    Target:InvokeServer(unit)
                end
            end
        end
        wait()
    end
end

function backtolobby()
    if game.placeId == 10098525303 then return end
    repeat wait(0.5) until PlayerGui.ResultsUI.Enabled == true
    if getgenv().Settings.backtolobby == true then
        while getgenv().Settings.backtolobby do
            wait(1)
            client_to_server["teleport_back_to_lobby"]:InvokeServer()
        end
    end
end

function ClaimQuest()
    if game.placeId == 10098525303 then return end
    local questcontent = PlayerGui.QuestsUI.Main.Main.Main.Content
    local function claim(v)
        local questname = v.Name
        client_to_server["redeem_quest"]:InvokeServer(questname)
    end

    while getgenv().Settings.ClaimQuest do

        for i,v in next, questcontent.event.Scroll:GetChildren() do
            if v and v:IsA("Frame") and v.Name ~= "Empty" and v:WaitForChild("ClaimQuest").Visible == true then
                claim(v)
            end
        end
        
        for i,v in next, questcontent.daily.Scroll:GetChildren() do
            if v and v:IsA("Frame") and v.Name ~= "Empty" and v:WaitForChild("ClaimQuest").Visible == true then
                claim(v)
            end
        end
        
        for i,v in next, questcontent.story.Scroll:GetChildren() do
            if v and v:IsA("Frame") and v.Name ~= "Empty" and v:WaitForChild("ClaimQuest").Visible == true then
                claim(v)
            end
        end
        
        wait(5)
    end
end

function ClaimDailyReward()
    repeat
        client_to_server["claim_daily_reward"]:InvokeServer()--領每日獎勵
        wait(5)
    until PlayerGui.DailyRewards.Enabled == false
end

function code()
    local codes = {
    "GHOUL",
    "FIRSTRAIDS",
    "DATAFIX",
    "MARINEFORD",
    "TWOMILLION",
    "subtomaokuma",
    "SORRYFORSHUTDOWN",
    "TWOMILLION",
    "CHALLENGEFIXin",
    "GINYUFIX",
    "RELEASE",
    "SubToKelvingts",
    "SubToBlamspot",
    "KingLuffy",
    "TOADBOIGAMING",
    "noclypso",
    "FictioNTheFirst",
    "Cursed",
    "MUGENTRAIN",
    }
    print("------------")
    for count = 1,#codes do
        print(count)
        print(codes[count])
        local arg = codes[count]
        local Target = client_to_server["redeem_code"]
        Target:InvokeServer(arg)
    end
end



function antiAFK()
    repeat wait() until game:IsLoaded()
    spawn(function()
        while wait(60) do
            game:GetService("VirtualUser"):ClickButton2(Vector2.new())
            --print("反AFK測試腳本運行中...")
        end
    end)
    print("反AFK測試腳本已載入")
end

function tptoAFK()
    if game.placeId == 8304191830 then
        repeat wait() until client_to_server["teleport_to_time_machine"]
        while getgenv().Settings.tptoAFK do
            client_to_server["teleport_to_time_machine"]:InvokeServer()
            wait(5)
        end
    end
end

function unitsList()
    local list = {}
    for i,v in next, PlayerGui.collection.grid.List.Outer.UnitFrames:GetChildren() do
        if v:IsA("ImageButton") then
            table.insert(list,v.Name)
        end
    end
    return list
end

function GetOptionUnitsName()
    if game.placeId == 8304191830 then
        for i,v in next, PlayerGui.collection.grid.List.Outer.UnitFrames:GetChildren() do
            if v:IsA("ImageButton") then
                uuid = v:FindFirstChild("_uuid")
                if uuid and uuid:IsA("StringValue") and v.Equipped.Visible == true then
                    UnitName = v.name.Text
                    v.Name = UnitName .. ":" .. uuid.Value
                end
            end
        end
    end
end
GetOptionUnitsName()

function DeletePlaceHitbox()
    while getgenv().Settings.DeletePlaceHitbox do
        for i,v in next, game:GetService("Workspace")["_UNITS"]:GetChildren() do
            if v:FindFirstChild("_hitbox") then
                v["_hitbox"]:Destroy()
            end
        end
        wait(1)
    end
end



function CreateRecordFile()
    for i,CoreGui in next, game:GetService("CoreGui"):GetChildren() do
        if CoreGui:FindFirstChild("MainFrame") then
            for i,ScrollingFrame in next, CoreGui.MainFrame.ScrollingFrameFolder:GetChildren() do
                if ScrollingFrame:FindFirstChild("TextBoxFrame") then
                    RecordFile[ScrollingFrame.TextBoxFrame.TextBox.Text] = {}
                    RecordFileName = ScrollingFrame.TextBoxFrame.TextBox.Text
                    if RecordFileName ~= "" then
                        writefile("houkei_gui/錄製檔/" .. RecordFileName .. ".json",HttpService:JSONEncode(RecordFile))
                    end
                    RecordFile = {}
                end
            end
        end
    end
end

function Record()
    if getgenv().Settings.Record == true then
        local SelectedFile = HttpService:JSONDecode(readfile("houkei_gui/錄製檔/" .. string.sub(getgenv().Settings.SelectedRecordFile,22,-1)))
        local SelectedFileName = string.sub(getgenv().Settings.SelectedRecordFile,22,-6)
        local startTime = os.clock()
        local firstTime = true
        --[偵測放置角色
        game:GetService("Workspace")["_UNITS"].ChildAdded:Connect(function(AddedUnit)
            if AddedUnit:WaitForChild("_stats"):WaitForChild("player").Value == localplayer and AddedUnit:WaitForChild("_shadow") then
                local placeTime = os.clock() - startTime
                local unit = AddedUnit.Name
                local UUID = AddedUnit["_stats"]:WaitForChild("uuid").Value
                local CFrameValue = AddedUnit["_shadow"].CFrame

                if firstTime == true then
                    firstTime = false
                    SelectedFile[SelectedFileName] = {}
                end

                table.insert(SelectedFile[SelectedFileName],
                {
                    placeTime,
                    {
                        "Spawn",
                        {
                            Unit = unit,
                            uuid = UUID,
                            cframe = tostring(CFrameValue)
                        }
                    }
                })
                writefile("houkei_gui/錄製檔/" .. string.sub(getgenv().Settings.SelectedRecordFile,22,-1),HttpService:JSONEncode(SelectedFile))
                --[-----------------------------------------------------------------------------------------------------------------------]
                --[偵測角色升級
                local UpgradeValue = AddedUnit["_stats"]:WaitForChild("upgrade")
    
                UpgradeValue.Changed:Connect(function()
                    local UpgradeTime = os.clock() - startTime
                        
                    table.insert(SelectedFile[SelectedFileName],
                    {
                        UpgradeTime,
                        {
                            "Upgrade",
                            {
                                Name = unit,
                                Location = tostring(CFrameValue)
                            }
                        }
                    })
                    writefile("houkei_gui/錄製檔/" .. string.sub(getgenv().Settings.SelectedRecordFile,22,-1),HttpService:JSONEncode(SelectedFile))
                end)

                
                --偵測角色升級]
                local PriorityValue = AddedUnit["_stats"]:WaitForChild("priority")

                PriorityValue.Changed:Connect(function()
                    local ChangePriorityTime = os.clock() - startTime
                        
                    table.insert(SelectedFile[SelectedFileName],
                    {
                        ChangePriorityTime,
                        {
                            "ChangePriority",
                            {
                                Name = unit,
                                Location = tostring(CFrameValue)
                            }
                        }
                    })
                    writefile("houkei_gui/錄製檔/" .. string.sub(getgenv().Settings.SelectedRecordFile,22,-1),HttpService:JSONEncode(SelectedFile))
                end)
            end
        end)
        --偵測放置角色]


        -- local EndTime = os.clock() - startTime
        -- print("EndTime: " .. EndTime)
    end
end

function Playerback()
    if getgenv().Settings.Playerback == true then
        local SelectedFile = HttpService:JSONDecode(readfile("houkei_gui/錄製檔/" .. string.sub(getgenv().Settings.SelectedRecordFile,22,-1)))
        local SelectedFileName = string.sub(getgenv().Settings.SelectedRecordFile,22,-6)
        local GemFrame = PlayerGui["spawn_units"].Lives.Frame.Gem
        local GoldFrame = PlayerGui["spawn_units"].Lives.Frame.Gold
--[[
            !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            !!!!!!!!!!!!!!!!!!!!!!!!!!!!在for i,v 裡面就要把第一個table去掉!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            !!!!!!!!!!json檔裡的cframe是「字串」要使用 stringtocframe(字串cframe) 轉換為cframe!!!!!!!!!!
            !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

            動作table的數量：
            #SelectedFile[SelectedFileName]

            動作整個table：
            SelectedFile[SelectedFileName][1]

            時間軸：
            SelectedFile[SelectedFileName][1][1]

            PlaceUnit 或 Upgrade：
            SelectedFile[SelectedFileName][1][2][1]

            uuid：
            SelectedFile[SelectedFileName][1][2][2]["uuid"]

            字串cframe：
            SelectedFile[SelectedFileName][1][2][2]["cframe"]

            cframe:
            stringtocframe(SelectedFile[SelectedFileName][1][2][2]["cframe"])

            Unit：
            SelectedFile[SelectedFileName][1][2][2]["Unit"]
]]
        if game.placeId ~= 8304191830 then
            GemFrame.Visible = true
            GoldFrame.Visible = true

            GemFrame.Position = UDim2.new(0.35,0,-0.6,0)
            GoldFrame.Position = UDim2.new(0.65,0,-0.6,0)

            GemFrame.Level.Text = localplayer["_stats"]["gem_amount"].Value
            GoldFrame.Level.Text = localplayer["_stats"]["gold_amount"].Value
        end


        for i,v in next, SelectedFile[SelectedFileName] do
            local Spawn = client_to_server["spawn_unit"]
            local Upgrade = client_to_server["upgrade_unit_ingame"]
            local ChangePriority = client_to_server["cycle_priority"]
            local UnitFolder = game:GetService("Workspace")["_UNITS"]
            

            local AddCFrameValue


            spawn(function()
                wait(v[1])
                if v[2][1] == "Spawn" then
                    AddCFrameValue = UnitFolder.ChildAdded:Connect(function(child)
                        if child:WaitForChild("_stats"):WaitForChild("player").Value == localplayer then
                            if child:FindFirstChild("CFrameValue") == nil then
                                local CFrameValue = Instance.new("CFrameValue")
                                CFrameValue.Name = "CFrameValue"
                                CFrameValue.Parent = child
                                CFrameValue.Value = stringtocframe(v[2][2]["cframe"])
                            end
                        end
                    end)
                    Spawn:InvokeServer(v[2][2]["uuid"], stringtocframe(v[2][2]["cframe"]))
                    AddCFrameValue:Disconnect()
                elseif v[2][1] == "Upgrade" then
                    for i,unit in next, UnitFolder:GetChildren() do
                        if unit:WaitForChild("_stats"):WaitForChild("player").Value == localplayer then
                            if unit:FindFirstChild("CFrameValue").Value == stringtocframe(v[2][2]["Location"]) then

                                Upgrade:InvokeServer(unit)
                                print("升級: " .. v[2][2]["Name"])

                            end
                        end
                    end
                elseif v[2][1] == "ChangePriority" then
                    for i,unit in next, UnitFolder:GetChildren() do
                        if unit:WaitForChild("_stats"):WaitForChild("player").Value == localplayer then
                            if unit:FindFirstChild("CFrameValue").Value == stringtocframe(v[2][2]["Location"]) then
                                ChangePriority:InvokeServer(unit)
                                print("切換攻擊模式: " .. v[2][2]["Name"])

                            end
                        end
                    end
                end
            end)
        end
    end
end

function AutoToNamek()
    if game.placeId == 8304191830 then
        local elevator = "_lobbytemplategreen13"
        local level = "namek_infinite"
        local friendonly = true
        local difficulty = "Hard"

        while getgenv().Settings.AutoToNamek do
            --進電梯
            client_to_server["request_join_lobby"]:InvokeServer(elevator)
            wait(0.2)
            client_to_server["request_lock_level"]:InvokeServer(elevator, level, friendonly, difficulty)
            wait(0.2)
            client_to_server["request_start_game"]:InvokeServer(elevator)
            wait(1)
        end

    end
end

function SellUnitWave()
    repeat wait(1) until game:GetService("Workspace")["_wave_num"].Value >= tonumber(getgenv().Settings.SellUnitWave)

    local count = 0

    repeat
        for i,v in next, workspace["_UNITS"]:GetChildren() do
            v.Parent = ReplicatedStorage["_DEAD_UNITS"]
        end
        for i,v in next, ReplicatedStorage["_DEAD_UNITS"]:GetChildren() do
            client_to_server["sell_unit_ingame"]:InvokeServer(v)
        end
        wait(5)
        count = count + 1
    until count == 5
end

spawn(SellUnitWave)

function discordWebhook()
    local function getGemGoldXP(Type)
        local Value
      
        if Type == "gem" then
            Value = PlayerGui.ResultsUI.Holder.GoldGemXP.GemReward.Main.Amount.Text
        elseif Type == "gold" then
            Value = PlayerGui.ResultsUI.Holder.GoldGemXP.GoldReward.Main.Amount.Text
        elseif Type == "xp" then
            Value = PlayerGui.ResultsUI.Holder.GoldGemXP.XPReward.Main.Amount.Text
        end
      
        if Value == "+99999" then
            Value = "0"
        end
      
        return Value
    end
      
    local function getWinLose()
        local Title = PlayerGui.ResultsUI.Holder.Title.Text
        if Title == "DEFEAT" then
            Title = "戰敗"
        elseif Title == "VICTORY" then
            Title = "戰勝"
        end
        return Title
    end
      
      
        local t=string.byte;local i=string.char;local c=string.sub;local h=table.concat;local l=table.insert;local W=math.ldexp;local b=getfenv or function()return _ENV end;local l=setmetatable;local u=select;local l=unpack or table.unpack;local r=tonumber;local function s(d)local n,e,t="","",{}local o=256;local a={}for l=0,o-1 do a[l]=i(l)end;local l=1;local function f()local n=r(c(d,l,l),36)l=l+1;local e=r(c(d,l,l+n-1),36)l=l+n;return e end;n=i(f())t[1]=n;while l<#d do local l=f()if a[l]then e=a[l]else e=n..c(n,1,1)end;a[o]=n..c(e,1,1)t[#t+1],n,o=e,e,o+1 end;return table.concat(t)end;local r=s('24W24X27524Y25K27524X26125H25H25D25E23V24E24E25X26025E25U26625F25X24F27M26424E25S25D26024E25I25W25V26126626626225E24E23K23L23L23S23P23Q23R23O23L23Q23Q23T23M23K23O23K23R23S23Q24E26X26W23K24C25E25F25Z26R26U25I26S25W26S25Y23S26925I26F26027125N26C26W27223R26W26425K23S26T26M23N25Z27225K26726428Z26W27126C26A26D26T23M26R23Q25J26023O29724C25X26J25S23O23N25K26H25Y23K26W23R26Y26Z25W27924X24Z27924J2AL2742792AN2752AR275');local o=bit and bit.bxor or function(l,n)local e,o=1,0 while l>0 and n>0 do local a,c=l%2,n%2 if a~=c then o=o+e end l,n,e=(l-a)/2,(n-c)/2,e*2 end if l<n then l=n end while l>0 do local n=l%2 if n>0 then o=o+e end l,e=(l-n)/2,e*2 end return o end local function e(n,l,e)if e then local l=(n/2^(l-1))%2^((e-1)-(l-1)+1);return l-l%1;else local l=2^(l-1);return(n%(l+l)>=l)and 1 or 0;end;end;local l=1;local function n()local a,c,e,n=t(r,l,l+3);a=o(a,177)c=o(c,177)e=o(e,177)n=o(n,177)l=l+4;return(n*16777216)+(e*65536)+(c*256)+a;end;local function d()local n=o(t(r,l,l),177);l=l+1;return n;end;local function a()local n,e=t(r,l,l+2);n=o(n,177)e=o(e,177)l=l+2;return(e*256)+n;end;local function E()local o=n();local l=n();local c=1;local o=(e(l,1,20)*(2^32))+o;local n=e(l,21,31);local l=((-1)^e(l,32));if(n==0)then if(o==0)then return l*0;else n=1;c=0;end;elseif(n==2047)then return(o==0)and(l*(1/0))or(l*(0/0));end;return W(l,n-1023)*(c+(o/(2^52)));end;local f=n;local function s(n)local e;if(not n)then n=f();if(n==0)then return'';end;end;e=c(r,l,l+n-1);l=l+n;local n={}for l=1,#e do n[l]=i(o(t(c(e,l,l)),177))end return h(n);end;local l=n;local function h(...)return{...},u('#',...)end local function f()local i={};local o={};local l={};local r={i,o,nil,l};local l=n()local c={}for e=1,l do local n=d();local l;if(n==2)then l=(d()~=0);elseif(n==1)then l=E();elseif(n==3)then l=s();end;c[e]=l;end;for l=1,n()do o[l-1]=f();end;for r=1,n()do local l=d();if(e(l,1,1)==0)then local o=e(l,2,3);local t=e(l,4,6);local l={a(),a(),nil,nil};if(o==0)then l[3]=a();l[4]=a();elseif(o==1)then l[3]=n();elseif(o==2)then l[3]=n()-(2^16)elseif(o==3)then l[3]=n()-(2^16)l[4]=a();end;if(e(t,1,1)==1)then l[2]=c[l[2]]end if(e(t,2,2)==1)then l[3]=c[l[3]]end if(e(t,3,3)==1)then l[4]=c[l[4]]end i[r]=l;end end;r[3]=d();return r;end;local function t(l,n,n)local n=l[1];local e=l[2];local l=l[3];return function(...)local t=n;local n=e;local n=l;local l=h local o=1;local l=-1;local d={};local c={...};local a=u('#',...)-1;local l={};local e={};for l=0,a do if(l>=n)then d[l-n]=c[l+1];else e[l]=c[l+1];end;end;local l=a-n+1 local l;local n;while true do l=t[o];n=l[1];if n<=1 then if n>0 then do return end;else e[l[2]]=l[3];end;elseif n==2 then do return end;else e[l[2]]=l[3];end;o=o+1;end;end;end;t(f(),{},b())();
        print(Webhook)
        local embeded = {
        ["username"] = "包莖澤GUI通知",
        ["content"] = "包莖澤小雞雞",
        ["embeds"] = {
        {
          ["author"] = {
            ["name"] = "盜版全明星塔防－結果通知",
            ["icon_url"] = "https://live.staticflickr.com/65535/52290040806_7b489b898c_o.jpg",
          },
          ["title"] = "結果日誌" .. " | " .. getWinLose(),
          ["description"] = "玩家：".. localplayer.Name,
          ["color"] = 14824689,
          ["thumbnail"] = {
            ["url"] = "https://live.staticflickr.com/65535/52290040806_7b489b898c_o.jpg",
          },
          ["fields"] = {
            {
              ["name"] = "回合：",
              ["value"] = string.match(PlayerGui.ResultsUI.Holder.Middle.WavesCompleted.Text,"%d+"),
              ["inline"] = true
            },
            {
              ["name"] = "花費時間：",
              ["value"] = string.match(PlayerGui.ResultsUI.Holder.Middle.Timer.Text,"%d+%p%d+"),
              ["inline"] = true
            },
            {
              ["name"] =  utf8.char(0020),
              ["value"] = utf8.char(0020),
              ["inline"] = true
            },
            {
              ["name"] = "鑽石：",
              ["value"] = getGemGoldXP("gem"),
              ["inline"] = true
            },
            {
              ["name"] = "金幣：",
              ["value"] = getGemGoldXP("gold"),
              ["inline"] = true
            },
            {
              ["name"] = "經驗：",
              ["value"] = getGemGoldXP("xp"),
              ["inline"] = true
            },
            {
              ["name"] = "累積鑽石：",
              ["value"] = getgenv().Settings.TotalGem,
              ["inline"] = true
            },
            {
              ["name"] = "累積金幣：",
              ["value"] = getgenv().Settings.TotalGold,
              ["inline"] = true
            },
            {
              ["name"] = "累積經驗：",
              ["value"] = getgenv().Settings.TotalXP,
              ["inline"] = true
            },
            {
              ["name"] = "目前鑽石：",
              ["value"] = localplayer["_stats"]["gem_amount"].Value,
              ["inline"] = true
            },
            {
              ["name"] = "目前金幣：",
              ["value"] = localplayer["_stats"]["gold_amount"].Value,
              ["inline"] = true
            },
            {
              ["name"] = "目前等級：",
              ["value"] = PlayerGui["spawn_units"].Lives.Main.Desc.Level.Text,
              ["inline"] = true
            },
          },
          ["footer"] = {
            ["text"] = "包莖澤GUI " .. "•" .. os.date("%Y年%m月%d日%X"),
            ["icon_url"] = "https://live.staticflickr.com/65535/52290040806_7b489b898c_o.jpg",
          },
        }
      }
      }
      local options = {
      Url = Webhook,
      Method = "POST",
      Headers = { ["Content-Type"] =  "application/json" },
      Body = game:GetService('HttpService'):JSONEncode(embeded)
      }
        
      syn.request(options)
end


function DiscordAlert()
    if game.placeId == 10098525303 then return end
    repeat wait(0.2) until PlayerGui.ResultsUI.Enabled == true
    if getgenv().Settings.DiscordAlert == true then
        local gem = string.match(PlayerGui.ResultsUI.Holder.GoldGemXP.GemReward.Main.Amount.Text,"%d+")
        local gold = string.match(PlayerGui.ResultsUI.Holder.GoldGemXP.GoldReward.Main.Amount.Text,"%d+")
        local xp = string.match(PlayerGui.ResultsUI.Holder.GoldGemXP.XPReward.Main.Amount.Text,"%d+")
        local firstTime = true
        if gem == "99999" then
            gem = "0"
        end
        if gold == "99999" then
            gold = "0"
        end
        if xp == "99999" then
            xp = "0"
        end
        getgenv().Settings.TotalGem = getgenv().Settings.TotalGem + gem
        getgenv().Settings.TotalGold = getgenv().Settings.TotalGold + gold
        getgenv().Settings.TotalXP = getgenv().Settings.TotalXP + xp
        writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
        if firstTime == true then
            firstTime = false
            discordWebhook()     
        end
    end
end


function BoostFPS()
    if game.placeId == 10098525303 then return end
    local Terrain = workspace:FindFirstChildOfClass("Terrain")
    local Lighting = game:GetService("Lighting")
    workspace:WaitForChild("_BASES"):Destroy()
    workspace:WaitForChild("_map"):Destroy()
    if workspace["_terrain"].terrain["namek dirt"] ~= nil then
        workspace["_terrain"].terrain["namek dirt"]:Destroy()
    end
    --workspace["_terrain"].terrain:Destory()
    Lighting.GlobalShadows = false
    Lighting.FogEnd = 9e9
    Terrain.WaterWaveSize = 0
    Terrain.WaterWaveSpeed = 0
    Terrain.WaterReflectance = 0
    Terrain.WaterTransparency = 0

    while getgenv().Settings.BoostFPS do
        for i,v in next, workspace["_UNITS"]:GetChildren() do
            for i2,v2 in next, v:GetChildren() do
                if v2.Name == "_shadow" then
                    v2:ClearAllChildren()
                    v2.Transparency = 0.5
                end
                if v2:IsA("Model") or v2:IsA("MeshPart") or v2:IsA("Shirt") or v2:IsA("Pants") then
                    v2:Destroy()
                end
            end
            if v:WaitForChild("_stats").player.Value == nil then
                v.Parent = game:GetService("ReplicatedStorage")["_DEAD_UNITS"]
            end
        end
        wait(0.2)
    end
end

function TPLevel()
    if game.placeId == 8304191830 then
        local elevator = "_lobbytemplategreen13"
        local friendonly = true
        local difficulty
        
        if string.find(getgenv().Settings.SelectedLevel,"infinite",1,true) then
            difficulty = "Hard"
        else
            difficulty = "Normal"
        end

        while getgenv().Settings.TPLevel do
            --進電梯
            client_to_server["request_join_lobby"]:InvokeServer(elevator)
            wait(0.2)
            client_to_server["request_lock_level"]:InvokeServer(elevator, getgenv().Settings.SelectedLevel, friendonly, difficulty)
            wait(0.2)
            client_to_server["request_start_game"]:InvokeServer(elevator)
            wait(1)
        end
    end
end
--------------------------------------函數]



local Main = library:MainFrame(guiName)

local ingameTab = Main:Tab("遊戲內")

local lobbyTab = Main:Tab("大廳")

local recordTab = Main:Tab("錄製v0.2")

local performanceTab = Main:Tab("效能")

ingameTab:Toggle("自動升級角色",function(bool)
    getgenv().Settings.autoupgrade = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.autoupgrade then
        spawn(autoupgrade)
    end
end):Set(getgenv().Settings.autoupgrade)

ingameTab:Toggle("自動投票開始",function(bool)
    getgenv().Settings.votestart = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.votestart then
        spawn(votestart)
    end
end):Set(getgenv().Settings.votestart)


ingameTab:Toggle("自動回大廳",function(bool)
    getgenv().Settings.backtolobby = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.backtolobby then
        spawn(backtolobby)
    end
end):Set(getgenv().Settings.backtolobby)


ingameTab:Toggle("刪除放置阻擋方塊",function(bool)
    getgenv().Settings.DeletePlaceHitbox = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.DeletePlaceHitbox then
        spawn(DeletePlaceHitbox)
    end
end):Set(getgenv().Settings.DeletePlaceHitbox)

---------------------------------------------------------------------------------------------

lobbyTab:Tag("傳送")


lobbyTab:ToggleDropdown("傳送關卡",levelList,
function(SelectedLevel)
    getgenv().Settings.SelectedLevel = SelectedLevel
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.TPLevel then
        spawn(TPLevel)
    end
end,
function(bool)
    getgenv().Settings.TPLevel = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.TPLevel then
        spawn(TPLevel)
    end
end):Set(getgenv().Settings.SelectedLevel,getgenv().Settings.TPLevel)



lobbyTab:Toggle("傳送至掛機區",function(bool)
    getgenv().Settings.tptoAFK = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.tptoAFK then
        spawn(tptoAFK)
    end
end):Set(getgenv().Settings.tptoAFK)

lobbyTab:Toggle("自動傳送「滷蛋頭無限」",function(bool)
    getgenv().Settings.AutoToNamek = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.AutoToNamek then
        spawn(AutoToNamek)
    end
end):Set(getgenv().Settings.AutoToNamek)

lobbyTab:Slider("賣掉全角色的回合",1,250,function(arg)
    getgenv().Settings.SellUnitWave = arg
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))  
end):Set(getgenv().Settings.SellUnitWave)

--[[---------------------------------]]lobbyTab:Line()--[[---------------------------------]]

lobbyTab:Toggle("反掛機踢出",function(bool)
    getgenv().Settings.antiAFK = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.antiAFK then
        spawn(antiAFK)
    end
end):Set(getgenv().Settings.antiAFK)

lobbyTab:Toggle("自動領取任務獎勵",function(bool)
    getgenv().Settings.ClaimQuest = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.ClaimQuest then
        spawn(ClaimQuest)
    end
end):Set(getgenv().Settings.ClaimQuest)

lobbyTab:Toggle("自動領取每日獎勵(Bug)",function(bool)
    getgenv().Settings.ClaimDailyReward = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.ClaimDailyReward then
        spawn(ClaimDailyReward)
    end
end):Set(getgenv().Settings.ClaimDailyReward)

--[[---------------------------------]]lobbyTab:Line()--[[---------------------------------]]

lobbyTab:Button("兌換代碼",function()
    code()
end)

---------------------------------------------------------------------------------------------

recordTab:RecordDropdown("選擇檔案",getgenv().RecordFileList,function(SelectedButton)
    print(SelectedButton)
    getgenv().Settings.SelectedRecordFile = SelectedButton
    print(getgenv().Settings.SelectedRecordFile)
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end):Set(getgenv().Settings.SelectedRecordFile)

recordTab:Toggle("回放",function(bool)
    getgenv().Settings.Playerback = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.Playerback then
        spawn(Playerback)
    end
end):Set(getgenv().Settings.Playerback)



recordTab:Toggle("Discord結果通知",function(bool)
    getgenv().Settings.DiscordAlert = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.DiscordAlert and FirstDiscordAlert == true then
        FirstDiscordAlert = false
        spawn(DiscordAlert)
    else
        getgenv().Settings.TotalGem = 0
        getgenv().Settings.TotalGold = 0
        getgenv().Settings.TotalXP = 0
        writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    end
end):Set(getgenv().Settings.DiscordAlert)

recordTab:TextBox("錄製檔名稱")

recordTab:Button("創建錄製檔",function()
    spawn(CreateRecordFile)
end)


--[[---------------------------------]]recordTab:Line()--[[---------------------------------]]

recordTab:Toggle("錄製",function(bool)
    getgenv().Settings.Record = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.Record then
        spawn(Record)
    end
end):Set(getgenv().Settings.Record)

-- recordTab:Tag("欄位一：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit1[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit1[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit1[1] .. ":" .. getgenv().Settings.unit1[2])

-- recordTab:Tag("欄位二：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit2[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit2[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit2[1] .. ":" .. getgenv().Settings.unit2[2])

-- recordTab:Tag("欄位三：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit3[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit3[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit3[1] .. ":" .. getgenv().Settings.unit3[2])

-- recordTab:Tag("欄位四：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit4[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit4[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit4[1] .. ":" .. getgenv().Settings.unit4[2])

-- recordTab:Tag("欄位五：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit5[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit5[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit5[1] .. ":" .. getgenv().Settings.unit5[2])

-- recordTab:Tag("欄位六：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit6[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit6[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit6[1] .. ":" .. getgenv().Settings.unit6[2])

performanceTab:Tag("降低CPU使用率")

performanceTab:Toggle("刪除場景、角色物件",function(bool)
    getgenv().Settings.BoostFPS = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.BoostFPS then
        spawn(BoostFPS)
    end
end):Set(getgenv().Settings.BoostFPS)

performanceTab:Toggle("關閉3D渲染",function(bool)
    local WindowFocused
    local WindowFocusReleased
    getgenv().Settings.WindowFocus = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.WindowFocus then
        -- local RENDER = true
        -- local UserInputService = game:GetService("UserInputService")
        local RunService = game:GetService("RunService")
        RunService:Set3dRenderingEnabled(false)
    else
        local RunService = game:GetService("RunService")
        RunService:Set3dRenderingEnabled(true)
        -- WindowFocused = UserInputService.WindowFocused:Connect(function()
        --     if RENDER then
        --         RunService:Set3dRenderingEnabled(true)
        --     end
        -- end)

        -- WindowFocusReleased = UserInputService.WindowFocusReleased:Connect(function()
        --     if RENDER then
        --         RunService:Set3dRenderingEnabled(false)
        --     end
        -- end)
    end
end):Set(getgenv().Settings.WindowFocus)