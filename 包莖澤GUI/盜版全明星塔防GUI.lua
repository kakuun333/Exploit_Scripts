repeat wait() until game:IsLoaded() and game.Players and game.Players.LocalPlayer and game.Players.LocalPlayer.Character or (game.placeId == 10098525303 and game:IsLoaded())
if game.GameId ~= 3183403065 then return end
--盜版全明星塔防GUI
local library = loadstring(game:HttpGet(("https://raw.githubusercontent.com/kakuun333/Exploit_Scripts/main/%E5%8C%85%E8%8E%96%E6%BE%A4GUI/GUI-Library/%E5%8C%85%E8%8E%96%E6%BE%A4GUI-Library.lua")))()

local client_to_server = game:GetService("ReplicatedStorage").endpoints["client_to_server"]
local players = game:GetService("Players")
local localplayer = players.LocalPlayer
local HttpService = game:GetService("HttpService")
local JSON
local OldSettings
local PlayerGui = localplayer.PlayerGui


getgenv().Settings = {
    votestart = false,
    autoupgrade = false,
    backtolobby = false,
    ClaimQuest = false,
    antiAFK = false,
    tptoAFK = false
}

print("[檢查「盜版全明星塔防GUI」設定檔完整性...]")
if isfolder("koukei_gui") then--有koukei資料夾
    print("koukei資料夾:存在")
else--沒有koukei資料夾
    makefolder("koukei_gui")
end

if isfile("koukei_gui/FakeAllStar.json") then--有FakeAllStar.json
    print("FakeAllStar.json:存在")
    --[導入OldSettings
    OldSettings = HttpService:JSONDecode(readfile("koukei_gui/FakeAllStar.json"))
    --導入OldSettings]
    --[檢查FakeAllStar.json完整性

    if OldSettings["votestart"] == nil then
        print('"votestart"值:缺失')
        OldSettings["votestart"] = false
        print('"votestart"值:已補上')
    else
        print('"votestart"值:存在')
    end

    if OldSettings["autoupgrade"] == nil then
        print('"autoupgrade"值:缺失')
        OldSettings["autoupgrade"] = false
        print('"autoupgrade"值:已補上')
    else
        print('"autoupgrade"值:存在')
    end

    if OldSettings["backtolobby"] == nil then
        print('"backtolobby"值:缺失')
        OldSettings["backtolobby"] = false
        print('"backtolobby"值:已補上')
    else
        print('"backtolobby"值:存在')
    end

    if OldSettings["ClaimQuest"] == nil then
        print('"ClaimQuest"值:缺失')
        OldSettings["ClaimQuest"] = false
        print('"ClaimQuest"值:已補上')
    else
        print('"ClaimQuest"值:存在')
    end

    if OldSettings["antiAFK"] == nil then
        print('"antiAFK"值:缺失')
        OldSettings["antiAFK"] = false
        print('"antiAFK"值:已補上')
    else
        print('"antiAFK"值:存在')
    end

    if OldSettings["tptoAFK"] == nil then
        print('"tptoAFK"值:缺失')
        OldSettings["tptoAFK"] = false
        print('"tptoAFK"值:已補上')
    else
        print('"tptoAFK"值:存在')
    end
    --檢查FakeAllStar.json完整性]
    --[導入OldSettings到getgenv().Settings
    getgenv().Settings = OldSettings
    print("設定檔導入成功！")
    print("[檢查「盜版全明星塔防GUI」設定檔完整性:完成]")
    --導入OldSettings到getgenv().Settings]
else
    JSON = HttpService:JSONEncode(getgenv().Settings)
    writefile("koukei_gui/FakeAllStar.json",JSON)
end

--[函數
function votestart()
    if game.placeId == 10098525303 then return end
    while getgenv().Settings.votestart do
        if game:GetService("Workspace")["_DATA"].VoteStart.VotingFinished.Value == false then
            client_to_server["vote_start"]:InvokeServer()
        end
        wait()
    end
end

function autoupgrade()
    if getgenv().Settings.autoupgrade then
        if game.placeId == 10098525303 then return end
        local messages = PlayerGui.MessageGui.messages
        messages.UIListLayout.SortOrder = Enum.SortOrder.Name
        messages.UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
        messages.ChildAdded:Connect(function(child)
            if child:IsA("Frame") and child.Name == "Error" and child:WaitForChild("Tex").Text == "Not enough money!" then
                child.Tex.Text = ""
                repeat wait() until child.UIScale
                child:Destroy()
            end
        end)
    end
    while getgenv().Settings.autoupgrade do
        for i,v in next, game:GetService("Workspace")["_UNITS"]:GetDescendants() do
            if v:IsA("ObjectValue") and v.Name == "player" then
                if v.Value == localplayer then
                    local unit = v.Parent.Parent
                    local Target = client_to_server["upgrade_unit_ingame"];
                    Target:InvokeServer(unit)
                end
            end
        end
        wait()
    end
end

function backtolobby()
    if game.placeId == 10098525303 then return end
    while getgenv().Settings.backtolobby do
        if PlayerGui.ResultsUI.Enabled == true then
            client_to_server["teleport_back_to_lobby"]:InvokeServer()
        end
        wait()
    end
end

function ClaimQuest()
    if game.placeId == 10098525303 then return end
    local questcontent = PlayerGui.QuestsUI.Main.Main.Main.Content
    local function claim(v)
        local questname = v.Name
        client_to_server["redeem_quest"]:InvokeServer(questname)
    end

    while getgenv().Settings.ClaimQuest do
        for i,v in next, questcontent.event.Scroll:GetChildren() do
            if v:IsA("Frame") then
                claim(v)
            end
        end
    
        for i,v in next, questcontent.daily.Scroll:GetChildren() do
            if v:IsA("Frame") then
                claim(v)
            end
        end
    
        for i,v in next, questcontent.story.Scroll:GetChildren() do
            if v:IsA("Frame") then
                claim(v)
            end
        end
        client_to_server["claim_daily_reward"]:InvokeServer()--領每日獎勵
        wait(5)
    end
end

function code()
    local codes = {
    "GHOUL",
    "FIRSTRAIDS",
    "DATAFIX",
    "MARINEFORD",
    "TWOMILLION",
    "subtomaokuma",
    "SORRYFORSHUTDOWN",
    "TWOMILLION",
    "CHALLENGEFIXin",
    "GINYUFIX",
    "RELEASE",
    "SubToKelvingts",
    "SubToBlamspot",
    "KingLuffy",
    "TOADBOIGAMING",
    "noclypso",
    "FictioNTheFirst",
    "Cursed",
    "MUGENTRAIN",
    }
    print("------------")
    for count = 1,#codes do
        print(count)
        print(codes[count])
        local arg = codes[count]
        local Target = client_to_server["redeem_code"]
        Target:InvokeServer(arg)
    end
end



function antiAFK()
    repeat wait() until game:IsLoaded()
    spawn(function()
        while wait(60) do
            game:GetService("VirtualUser"):ClickButton2(Vector2.new())
            print("反AFK測試腳本運行中...")
        end
    end)
    print("反AFK測試腳本已載入")
end

function tptoAFK()
    if game.placeId == 8304191830 then
        repeat wait() until client_to_server["teleport_to_time_machine"]
        while getgenv().Settings.tptoAFK do
            client_to_server["teleport_to_time_machine"]:InvokeServer()
            wait(5)
        end
    end
end

--函數]


local Main = library:MainFrame("盜版全明星塔防GUI")

local ingameTab = Main:Tab("遊戲內")

local lobbyTab = Main:Tab("大廳")

ingameTab:Toggle("自動升級角色",function(bool)
    getgenv().Settings.autoupgrade = bool
    writefile("koukei_gui/FakeAllStar.json",HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.autoupgrade then
        spawn(autoupgrade)
    end
end):Set(getgenv().Settings.autoupgrade)

ingameTab:Toggle("自動投票開始",function(bool)
    getgenv().Settings.votestart = bool
    writefile("koukei_gui/FakeAllStar.json",HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.votestart then
        spawn(votestart)
    end
end):Set(getgenv().Settings.votestart)


ingameTab:Toggle("自動回大廳",function(bool)
    getgenv().Settings.backtolobby = bool
    writefile("koukei_gui/FakeAllStar.json",HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.backtolobby then
        spawn(backtolobby)
    end
end):Set(getgenv().Settings.backtolobby)


lobbyTab:Toggle("傳送至掛機區",function(bool)
    getgenv().Settings.tptoAFK = bool
    writefile("koukei_gui/FakeAllStar.json",HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.tptoAFK then
        spawn(tptoAFK)
    end
end):Set(getgenv().Settings.tptoAFK)

lobbyTab:Toggle("反掛機踢出",function(bool)
    getgenv().Settings.antiAFK = bool
    writefile("koukei_gui/FakeAllStar.json",HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.antiAFK then
        spawn(antiAFK)
    end
end):Set(getgenv().Settings.antiAFK)

lobbyTab:Toggle("自動領取任務獎勵",function(bool)
    getgenv().Settings.ClaimQuest = bool
    writefile("koukei_gui/FakeAllStar.json",HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.ClaimQuest then
        spawn(ClaimQuest)
    end
end):Set(getgenv().Settings.ClaimQuest)

lobbyTab:Button("兌換代碼",function()
    code()
end)
