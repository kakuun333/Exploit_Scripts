repeat wait() until game:IsLoaded() and game.Players and game.Players.LocalPlayer and game.Players.LocalPlayer.Character or (game.placeId == 10098525303 and game:IsLoaded())
if game.GameId ~= 3183403065 then return end
--盜版全明星塔防GUI
local library = loadstring(game:HttpGet(("https://raw.githubusercontent.com/kakuun333/Exploit_Scripts/main/%E5%8C%85%E8%8E%96%E6%BE%A4GUI/GUI-Library/%E5%8C%85%E8%8E%96%E6%BE%A4GUI-Library.lua")))()

local HttpService = game:GetService("HttpService")
local players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local localplayer = players.LocalPlayer
local PlayerGui = localplayer.PlayerGui

local client_to_server = ReplicatedStorage.endpoints["client_to_server"]

local JSON
local OldSettings
local settingdata = "koukei_gui/FakeAllStar.json"

local uuid
local UnitName
local RecordFile = {}
local RecordFileName


-- table.remove(units,table.find(units,"UIListLayout"))
-- table.remove(units,table.find(units,"UIGridLayout"))

getgenv().Settings = {
    votestart = false,
    autoupgrade = false,
    backtolobby = false,
    ClaimQuest = false,
    antiAFK = false,
    tptoAFK = false,
    ClaimDailyReward = false,
    DeletePlaceHitbox = false,
    Record = false,
    Playback = false,
    unit1 = {"UnitName","uuid"},
    unit2 = {"UnitName","uuid"},
    unit3 = {"UnitName","uuid"},
    unit4 = {"UnitName","uuid"},
    unit5 = {"UnitName","uuid"},
    unit6 = {"UnitName","uuid"}
}

getgenv().RecordFileList = listfiles("koukei_gui/錄製檔")

spawn(function()
    while wait(1) do
        getgenv().RecordFileList = listfiles("koukei_gui/錄製檔")
    end
end)

function CheckData(DataName)
    if OldSettings[DataName] == nil then
        print(DataName .. "值:缺失")
        OldSettings[DataName] = false
        print(DataName .. "值:已補上")
    else
        print(DataName .. "值:存在")
    end
end

-- function CheckDataArray(DataName)
--     if OldSettings[DataName][1] == nil then
--         print(DataName .. "陣列:缺失")
--         OldSettings[DataName] = false
--         print(DataName .. "陣列:已補上")
--     else
--         print(DataName .. "陣列:存在")
--     end
-- end

print("[檢查「盜版全明星塔防GUI」設定檔完整性...]")

--[檢查資料夾
if isfolder("koukei_gui") then--有koukei資料夾
    print("koukei資料夾:存在")
else
    makefolder("koukei_gui")
end

if isfolder("koukei_gui/錄製檔") then
    print("錄製檔資料夾:存在")
else
    makefolder("koukei_gui/錄製檔")
end
--檢查資料夾]





if isfile(settingdata) then--有FakeAllStar.json
    print("FakeAllStar.json:存在")
    --[導入OldSettings
    OldSettings = HttpService:JSONDecode(readfile(settingdata))
    --導入OldSettings]
    --[檢查FakeAllStar.json完整性
    CheckData("votestart")

    CheckData("autoupgrade")

    CheckData("backtolobby")

    CheckData("ClaimQuest")

    CheckData("antiAFK")

    CheckData("tptoAFK")

    CheckData("ClaimDailyReward")

    CheckData("unit1")

    CheckData("unit2")

    CheckData("unit3")

    CheckData("unit4")

    CheckData("unit5")

    CheckData("unit6")

    CheckData("DeletePlaceHitbox")

    CheckData("Record")

    CheckData("Playback")

    --檢查FakeAllStar.json完整性]
    --[導入OldSettings到getgenv().Settings
    getgenv().Settings = OldSettings
    print("設定檔導入成功！")
    print("[檢查「盜版全明星塔防GUI」設定檔完整性:完成]")
    --導入OldSettings到getgenv().Settings]
else
    JSON = HttpService:JSONEncode(getgenv().Settings)
    writefile(settingdata,JSON)
end


--[函數
function votestart()
    if game.placeId == 10098525303 then return end
    while getgenv().Settings.votestart do
        if game:GetService("Workspace")["_DATA"].VoteStart.VotingFinished.Value == false then
            client_to_server["vote_start"]:InvokeServer()
        end
        wait()
    end
end

function autoupgrade()
    if getgenv().Settings.autoupgrade then
        if game.placeId == 10098525303 then return end
        local messages = PlayerGui.MessageGui.messages
        messages.UIListLayout.SortOrder = Enum.SortOrder.Name
        messages.UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
        messages.ChildAdded:Connect(function(child)
            if child:IsA("Frame") and child.Name == "Error" and child:WaitForChild("Tex").Text == "Not enough money!" then
                child.Tex.Text = ""
                repeat wait() until child.UIScale
                child:Destroy()
            end
        end)
    end
    while getgenv().Settings.autoupgrade do
        for i,v in next, game:GetService("Workspace")["_UNITS"]:GetDescendants() do
            if v:IsA("ObjectValue") and v.Name == "player" then
                if v.Value == localplayer then
                    local unit = v.Parent.Parent
                    local Target = client_to_server["upgrade_unit_ingame"]
                    Target:InvokeServer(unit)
                end
            end
        end
        wait()
    end
end

function backtolobby()
    if game.placeId == 10098525303 then return end
    while getgenv().Settings.backtolobby do
        if PlayerGui.ResultsUI.Enabled == true then
            client_to_server["teleport_back_to_lobby"]:InvokeServer()
        end
        wait()
    end
end

function ClaimQuest()
    if game.placeId == 10098525303 then return end
    local questcontent = PlayerGui.QuestsUI.Main.Main.Main.Content
    local function claim(v)
        local questname = v.Name
        client_to_server["redeem_quest"]:InvokeServer(questname)
    end

    while getgenv().Settings.ClaimQuest do

        for i,v in next, questcontent.event.Scroll:GetChildren() do
            if v and v:IsA("Frame") and v.Name ~= "Empty" and v:WaitForChild("ClaimQuest").Visible == true then
                claim(v)
            end
        end
        
        for i,v in next, questcontent.daily.Scroll:GetChildren() do
            if v and v:IsA("Frame") and v.Name ~= "Empty" and v:WaitForChild("ClaimQuest").Visible == true then
                claim(v)
            end
        end
        
        for i,v in next, questcontent.story.Scroll:GetChildren() do
            if v and v:IsA("Frame") and v.Name ~= "Empty" and v:WaitForChild("ClaimQuest").Visible == true then
                claim(v)
            end
        end
        
        wait(5)
    end
end

function ClaimDailyReward()
    repeat
        client_to_server["claim_daily_reward"]:InvokeServer()--領每日獎勵
        wait(5)
    until PlayerGui.DailyRewards.Enabled == false
end

function code()
    local codes = {
    "GHOUL",
    "FIRSTRAIDS",
    "DATAFIX",
    "MARINEFORD",
    "TWOMILLION",
    "subtomaokuma",
    "SORRYFORSHUTDOWN",
    "TWOMILLION",
    "CHALLENGEFIXin",
    "GINYUFIX",
    "RELEASE",
    "SubToKelvingts",
    "SubToBlamspot",
    "KingLuffy",
    "TOADBOIGAMING",
    "noclypso",
    "FictioNTheFirst",
    "Cursed",
    "MUGENTRAIN",
    }
    print("------------")
    for count = 1,#codes do
        print(count)
        print(codes[count])
        local arg = codes[count]
        local Target = client_to_server["redeem_code"]
        Target:InvokeServer(arg)
    end
end



function antiAFK()
    repeat wait() until game:IsLoaded()
    spawn(function()
        while wait(60) do
            game:GetService("VirtualUser"):ClickButton2(Vector2.new())
            --print("反AFK測試腳本運行中...")
        end
    end)
    print("反AFK測試腳本已載入")
end

function tptoAFK()
    if game.placeId == 8304191830 then
        repeat wait() until client_to_server["teleport_to_time_machine"]
        while getgenv().Settings.tptoAFK do
            client_to_server["teleport_to_time_machine"]:InvokeServer()
            wait(5)
        end
    end
end

function unitsList()
    local list = {}
    for i,v in next, PlayerGui.collection.grid.List.Outer.UnitFrames:GetChildren() do
        if v:IsA("ImageButton") then
            table.insert(list,v.Name)
        end
    end
    return list
end

function GetOptionUnitsName()
    if game.placeId == 8304191830 then
        for i,v in next, PlayerGui.collection.grid.List.Outer.UnitFrames:GetChildren() do
            if v:IsA("ImageButton") then
                uuid = v:FindFirstChild("_uuid")
                if uuid and uuid:IsA("StringValue") and v.Equipped.Visible == true then
                    UnitName = v.name.Text
                    v.Name = UnitName .. ":" .. uuid.Value
                end
            end
        end
    end
end
GetOptionUnitsName()

function DeletePlaceHitbox()
    while getgenv().Settings.DeletePlaceHitbox do
        for i,v in next, game:GetService("Workspace")["_UNITS"]:GetChildren() do
            if v:FindFirstChild("_hitbox") then
                v["_hitbox"]:Destroy()
            end
        end
        wait(1)
    end
end



function CreateRecordFile()
    for i,CoreGui in next, game:GetService("CoreGui"):GetChildren() do
        if CoreGui:FindFirstChild("MainFrame") then
            for i,ScrollingFrame in next, CoreGui.MainFrame.ScrollingFrameFolder:GetChildren() do
                if ScrollingFrame:FindFirstChild("TextBoxFrame") then
                    RecordFile[ScrollingFrame.TextBoxFrame.TextBox.Text] = {}
                    RecordFileName = ScrollingFrame.TextBoxFrame.TextBox.Text
                    if RecordFileName ~= "" then
                        writefile("koukei_gui/錄製檔/" .. RecordFileName .. ".json",HttpService:JSONEncode(RecordFile))
                    end
                    RecordFile = {}
                end
            end
        end
    end
end

function Record()
    if getgenv().Settings.Record == true then
        local startTime = os.clock()
        readfile()


        local EndTime = os.clock() - startTime
        print("EndTime: " .. EndTime)
    end
end

-- function GetRecordFileList()
--     while wait(1) do
--         getgenv().RecordFileList = listfiles("koukei_gui/錄製檔")
--         return getgenv().RecordFileList
--     end
-- end
--函數]


local Main = library:MainFrame("盜版全明星塔防GUI")

local ingameTab = Main:Tab("遊戲內")

local lobbyTab = Main:Tab("大廳")

local recordTab = Main:Tab("錄製(編寫中)")

ingameTab:Toggle("自動升級角色",function(bool)
    getgenv().Settings.autoupgrade = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.autoupgrade then
        spawn(autoupgrade)
    end
end):Set(getgenv().Settings.autoupgrade)

ingameTab:Toggle("自動投票開始",function(bool)
    getgenv().Settings.votestart = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.votestart then
        spawn(votestart)
    end
end):Set(getgenv().Settings.votestart)


ingameTab:Toggle("自動回大廳",function(bool)
    getgenv().Settings.backtolobby = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.backtolobby then
        spawn(backtolobby)
    end
end):Set(getgenv().Settings.backtolobby)


ingameTab:Toggle("刪除放置阻擋方塊",function(bool)
    getgenv().Settings.DeletePlaceHitbox = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.DeletePlaceHitbox then
        spawn(DeletePlaceHitbox)
    end
end):Set(getgenv().Settings.DeletePlaceHitbox)



lobbyTab:Toggle("傳送至掛機區",function(bool)
    getgenv().Settings.tptoAFK = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.tptoAFK then
        spawn(tptoAFK)
    end
end):Set(getgenv().Settings.tptoAFK)

lobbyTab:Toggle("反掛機踢出",function(bool)
    getgenv().Settings.antiAFK = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.antiAFK then
        spawn(antiAFK)
    end
end):Set(getgenv().Settings.antiAFK)

lobbyTab:Toggle("自動領取任務獎勵",function(bool)
    getgenv().Settings.ClaimQuest = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.ClaimQuest then
        spawn(ClaimQuest)
    end
end):Set(getgenv().Settings.ClaimQuest)

lobbyTab:Toggle("自動領取每日獎勵",function(bool)
    getgenv().Settings.ClaimDailyReward = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.ClaimDailyReward then
        spawn(ClaimDailyReward)
    end
end):Set(getgenv().Settings.ClaimDailyReward)

lobbyTab:Button("兌換代碼",function()
    code()
end)
---------------------------------------------------------------------------------------------

recordTab:Dropdown("選擇檔案",getgenv().RecordFileList,function()

end)


recordTab:Toggle("錄製",function(bool)
    getgenv().Settings.Record = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.Record then
        spawn(--[[Record]])
    end
end):Set(getgenv().Settings.Record)

recordTab:Toggle("回放",function(bool)
    getgenv().Settings.Playerback = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.Playerback then
        spawn(--[[Playerback]])
    end
end):Set(getgenv().Settings.Playerback)


recordTab:TextBox("錄製檔名稱")

recordTab:Button("創建錄製檔",function()
    spawn(CreateRecordFile)
end)


--[[---------------------------------]]recordTab:Line()--[[---------------------------------]]

recordTab:Tag("欄位一：")

recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
    getgenv().Settings.unit1[1] = SelectedButton["name"].Text
    getgenv().Settings.unit1[2] = SelectedButton["_uuid"].Value
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end):Set(getgenv().Settings.unit1[1] .. ":" .. getgenv().Settings.unit1[2])

recordTab:Tag("欄位二：")

recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
    getgenv().Settings.unit2[1] = SelectedButton["name"].Text
    getgenv().Settings.unit2[2] = SelectedButton["_uuid"].Value
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end):Set(getgenv().Settings.unit2[1] .. ":" .. getgenv().Settings.unit2[2])

recordTab:Tag("欄位三：")

recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
    getgenv().Settings.unit3[1] = SelectedButton["name"].Text
    getgenv().Settings.unit3[2] = SelectedButton["_uuid"].Value
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end):Set(getgenv().Settings.unit3[1] .. ":" .. getgenv().Settings.unit3[2])

recordTab:Tag("欄位四：")

recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
    getgenv().Settings.unit4[1] = SelectedButton["name"].Text
    getgenv().Settings.unit4[2] = SelectedButton["_uuid"].Value
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end):Set(getgenv().Settings.unit4[1] .. ":" .. getgenv().Settings.unit4[2])

recordTab:Tag("欄位五：")

recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
    getgenv().Settings.unit5[1] = SelectedButton["name"].Text
    getgenv().Settings.unit5[2] = SelectedButton["_uuid"].Value
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end):Set(getgenv().Settings.unit5[1] .. ":" .. getgenv().Settings.unit5[2])

recordTab:Tag("欄位六：")

recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
    getgenv().Settings.unit6[1] = SelectedButton["name"].Text
    getgenv().Settings.unit6[2] = SelectedButton["_uuid"].Value
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end):Set(getgenv().Settings.unit6[1] .. ":" .. getgenv().Settings.unit6[2])
