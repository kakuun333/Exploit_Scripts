repeat wait() until game:IsLoaded() and game.Players and game.Players.LocalPlayer and game.Players.LocalPlayer.Character
--盜版全明星塔防GUI
local library = loadstring(game:HttpGet(("https://raw.githubusercontent.com/kakuun333/Exploit_Scripts/main/%E5%8C%85%E8%8E%96%E6%BE%A4GUI/GUI-Library/%E5%8C%85%E8%8E%96%E6%BE%A4GUI-Library.lua")))()

local client_to_server = game:GetService("ReplicatedStorage").endpoints["client_to_server"]
local players = game:GetService("Players")
local localplayer = players.LocalPlayer
local HttpService = game:GetService("HttpService")
local JSON


if isfolder("koukei_gui") then--有koukei資料夾
    print("koukei資料夾:存在")
else--沒有koukei資料夾
    makefolder("koukei_gui")
end

if isfile("koukei_gui/FakeAllStar.json") then--有FakeAllStar.json
    print("FalkeAllStar.json:存在")
    getgenv().Settings = HttpService:JSONDecode(readfile("koukei_gui/FakeAllStar.json"))
else
    getgenv().Settings = {
        votestart = false,
        autoupgrade = false,
        backtolobby = false,
        ClaimQuest = false
    }
    JSON = HttpService:JSONEncode(getgenv().Settings)
    writefile("koukei_gui/FakeAllStar.json",JSON)
end

--[函數
function votestart()
    while getgenv().Settings.votestart do
        if game:GetService("Workspace")["_DATA"].VoteStart.VotingFinished.Value == false then
            client_to_server["vote_start"]:InvokeServer()
        end
        wait()
    end
end

function autoupgrade()
    if getgenv().Settings.autoupgrade then
        local messages =  localplayer.PlayerGui.MessageGui.messages
        repeat wait() until messages.UIListLayout
        messages.UIListLayout.SortOrder = Enum.SortOrder.Name
        messages.UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
        messages.ChildAdded:Connect(function(child)
            if child:IsA("Frame") and child.Name == "Error" and child:WaitForChild("Tex").Text == "Not enough money!" then
                child.Tex.Text = ""
                repeat wait() until child.UIScale
                child:Destroy()
            end
        end)
    end
    while getgenv().Settings.autoupgrade do
        for i,v in next, game:GetService("Workspace")["_UNITS"]:GetDescendants() do
            if v:IsA("ObjectValue") and v.Name == "player" then
                if v.Value == localplayer then
                    local unit = v.Parent.Parent
                    local Target = client_to_server["upgrade_unit_ingame"];
                    Target:InvokeServer(unit)
                end
            end
        end
        wait()
    end
end

function backtolobby()
    while getgenv().Settings.backtolobby do
        if localplayer.PlayerGui.ResultsUI.Enabled == true then
            client_to_server["teleport_back_to_lobby"]:InvokeServer()
        end
        wait()
    end
end

function ClaimQuest()
    local questcontent = localplayer.PlayerGui.QuestsUI.Main.Main.Main.Content

    local function claim(v)
        local questname = v.Name
        client_to_server["redeem_quest"]:InvokeServer(questname)
    end

    while getgenv().Settings.ClaimQuest do
        for i,v in next, questcontent.event.Scroll:GetChildren() do
            if v:IsA("Frame") then
                claim(v)
            end
        end
    
        for i,v in next, questcontent.daily.Scroll:GetChildren() do
            if v:IsA("Frame") then
                claim(v)
            end
        end
    
        for i,v in next, questcontent.story.Scroll:GetChildren() do
            if v:IsA("Frame") then
                claim(v)
            end
        end
        client_to_server["claim_daily_reward"]:InvokeServer()--領每日獎勵
        wait(5)
    end
end

function code()
    local codes = {
    "GHOUL",
    "FIRSTRAIDS",
    "DATAFIX",
    "MARINEFORD",
    "TWOMILLION",
    "subtomaokuma",
    "SORRYFORSHUTDOWN",
    "TWOMILLION",
    "CHALLENGEFIXin",
    "GINYUFIX",
    "RELEASE",
    "SubToKelvingts",
    "SubToBlamspot",
    "KingLuffy",
    "TOADBOIGAMING",
    "noclypso",
    "FictioNTheFirst",
    "Cursed",
    "MUGENTRAIN",
    }
    print("------------")
    for count = 1,#codes do
        print(count)
        print(codes[count])
        local arg = codes[count]
        local Target = client_to_server["redeem_code"]
        Target:InvokeServer(arg)
    end
end
--函數]


local Main = library:MainFrame("盜版全明星塔防GUI")

local Auto = Main:Tab("自動")

Auto:Toggle("自動升級角色",function(bool)
    getgenv().Settings.autoupgrade = bool
    writefile("koukei_gui/FakeAllStar.json",HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.autoupgrade then
        spawn(autoupgrade)
    end
end):Set(getgenv().Settings.autoupgrade)

Auto:Toggle("自動投票開始",function(bool)
    getgenv().Settings.votestart = bool
    writefile("koukei_gui/FakeAllStar.json",HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.votestart then
        print("あ")
        spawn(votestart)
        print("い")
    end
end):Set(getgenv().Settings.votestart)


Auto:Toggle("自動回大廳",function(bool)
    getgenv().Settings.backtolobby = bool
    writefile("koukei_gui/FakeAllStar.json",HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.backtolobby then
        spawn(backtolobby)
    end
end):Set(getgenv().Settings.backtolobby)

Auto:Toggle("自動領取任務獎勵",function(bool)
    getgenv().Settings.ClaimQuest = bool
    writefile("koukei_gui/FakeAllStar.json",HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.ClaimQuest then
        spawn(ClaimQuest)
    end
end):Set(getgenv().Settings.ClaimQuest)

Auto:Button("自動兌換代碼",function()
    code()
end)


local tpTab = Main:Tab("傳送")

tpTab:Button("傳送至掛機區",function()
    client_to_server["teleport_to_time_machine"]:InvokeServer()
end)

