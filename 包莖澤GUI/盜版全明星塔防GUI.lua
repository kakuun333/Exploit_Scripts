repeat wait() until game:IsLoaded() and game.Players and game.Players.LocalPlayer and game.Players.LocalPlayer.Character or (game.placeId == 10098525303 and game:IsLoaded())
if game.GameId ~= 3183403065 then return end
--盜版全明星塔防GUI

local HttpService = game:GetService("HttpService")
local JSON
local OldSettings
local settingdata = "houkei_gui/FakeAllStar.json"

getgenv().Settings = {
    votestart = false,
    autoupgrade = false,
    backtolobby = false,
    ClaimQuest = false,
    antiAFK = false,
    tptoAFK = false,
    ClaimDailyReward = false,
    DeletePlaceHitbox = false,
    Record = false,
    Playback = false,
    AutoToNamek = false,
    unit1 = {"UnitName","uuid"},
    unit2 = {"UnitName","uuid"},
    unit3 = {"UnitName","uuid"},
    unit4 = {"UnitName","uuid"},
    unit5 = {"UnitName","uuid"},
    unit6 = {"UnitName","uuid"},
    SelectedRecordFile = "選擇錄製檔",
    SellUnitWave = 250,
    DiscordAlert = true,
    TotalGem = 0,
    TotalGold = 0,
    TotalXP = 0,
    BoostFPS = false,
    WindowFocus = false,
}

function CheckData(DataName)
    if OldSettings[DataName] == nil then
        print(DataName .. "值:缺失")
        OldSettings[DataName] = getgenv().Settings[DataName]
        print(DataName .. "值:已補上")
    else
        print(DataName .. "值:存在")
    end
end

-- function CheckDataArray(DataName)
--     if OldSettings[DataName][1] == nil then
--         print(DataName .. "陣列:缺失")
--         OldSettings[DataName] = false
--         print(DataName .. "陣列:已補上")
--     else
--         print(DataName .. "陣列:存在")
--     end
-- end

print("[檢查「盜版全明星塔防GUI」設定檔完整性...]")

--[檢查資料夾
if isfolder("houkei_gui") then--有houkei資料夾
    print("houkei資料夾:存在")
else
    makefolder("houkei_gui")
end

if isfolder("houkei_gui/錄製檔") then
    print("錄製檔資料夾:存在")
else
    makefolder("houkei_gui/錄製檔")
end
--檢查資料夾]




if isfile(settingdata) then--有FakeAllStar.json
    print("FakeAllStar.json:存在")
    --[導入OldSettings
    OldSettings = HttpService:JSONDecode(readfile(settingdata))
    --導入OldSettings]
    --[檢查FakeAllStar.json完整性
    CheckData("votestart")

    CheckData("autoupgrade")

    CheckData("backtolobby")

    CheckData("ClaimQuest")

    CheckData("antiAFK")

    CheckData("tptoAFK")

    CheckData("ClaimDailyReward")

    CheckData("unit1")

    CheckData("unit2")

    CheckData("unit3")

    CheckData("unit4")

    CheckData("unit5")

    CheckData("unit6")

    CheckData("DeletePlaceHitbox")

    CheckData("Record")

    CheckData("Playback")

    CheckData("SelectedRecordFile")

    CheckData("AutoToNamek")

    CheckData("SellUnitWave")

    CheckData("TotalGem")

    CheckData("TotalGold")

    CheckData("TotalXP")

    CheckData("DiscordAlert")

    CheckData("BoostFPS")

    CheckData("WindowFocus")

    --檢查FakeAllStar.json完整性]
    --[導入OldSettings到getgenv().Settings
    getgenv().Settings = OldSettings
    print("設定檔導入成功！")
    print("[檢查「盜版全明星塔防GUI」設定檔完整性:完成]")
    --導入OldSettings到getgenv().Settings]
else
    JSON = HttpService:JSONEncode(getgenv().Settings)
    writefile(settingdata,JSON)
end



getgenv().RecordFileList = listfiles("houkei_gui/錄製檔")



local library = loadstring(game:HttpGet(("https://raw.githubusercontent.com/kakuun333/Exploit_Scripts/main/%E5%8C%85%E8%8E%96%E6%BE%A4GUI/GUI-Library/%E5%8C%85%E8%8E%96%E6%BE%A4GUI-Library.lua")))()


local players = game:GetService("Players")
local localplayer = players.LocalPlayer
local PlayerGui = localplayer.PlayerGui
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local client_to_server = ReplicatedStorage.endpoints["client_to_server"]


local FirstDiscordAlert = true
local uuid
local UnitName
local RecordFile = {}
local RecordFileName
-- local RecordFileList = {}

-- table.remove(units,table.find(units,"UIListLayout"))
-- table.remove(units,table.find(units,"UIGridLayout"))


spawn(function()
    while wait(1) do
        getgenv().RecordFileList = listfiles("houkei_gui/錄製檔")
    end
end)




--------------------------------------[函數

function stringtocframe(str)
    return CFrame.new(table.unpack(str:gsub(" ",""):split(",")))
end

function votestart()
    if game.placeId == 10098525303 then return end
    while getgenv().Settings.votestart do
        if game:GetService("Workspace")["_DATA"].VoteStart.VotingFinished.Value == false then
            client_to_server["vote_start"]:InvokeServer()
        end
        wait()
    end
end

function autoupgrade()
    if getgenv().Settings.autoupgrade then
        if game.placeId == 10098525303 then return end
        local messages = PlayerGui.MessageGui.messages
        messages.UIListLayout.SortOrder = Enum.SortOrder.Name
        messages.UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
        messages.ChildAdded:Connect(function(child)
            if child:IsA("Frame") and child.Name == "Error" and child:WaitForChild("Tex").Text == "Not enough money!" then
                child.Tex.Text = ""
                repeat wait() until child.UIScale
                child:Destroy()
            end
        end)
    end
    while getgenv().Settings.autoupgrade do
        for i,v in next, game:GetService("Workspace")["_UNITS"]:GetDescendants() do
            if v:IsA("ObjectValue") and v.Name == "player" then
                if v.Value == localplayer then
                    local unit = v.Parent.Parent
                    local Target = client_to_server["upgrade_unit_ingame"]
                    Target:InvokeServer(unit)
                end
            end
        end
        wait()
    end
end

function backtolobby()
    if game.placeId == 10098525303 then return end
    repeat wait(0.5) until PlayerGui.ResultsUI.Enabled == true
    if getgenv().Settings.backtolobby == true then
        while getgenv().Settings.backtolobby do
            wait(1)
            client_to_server["teleport_back_to_lobby"]:InvokeServer()
        end
    end
end

function ClaimQuest()
    if game.placeId == 10098525303 then return end
    local questcontent = PlayerGui.QuestsUI.Main.Main.Main.Content
    local function claim(v)
        local questname = v.Name
        client_to_server["redeem_quest"]:InvokeServer(questname)
    end

    while getgenv().Settings.ClaimQuest do

        for i,v in next, questcontent.event.Scroll:GetChildren() do
            if v and v:IsA("Frame") and v.Name ~= "Empty" and v:WaitForChild("ClaimQuest").Visible == true then
                claim(v)
            end
        end
        
        for i,v in next, questcontent.daily.Scroll:GetChildren() do
            if v and v:IsA("Frame") and v.Name ~= "Empty" and v:WaitForChild("ClaimQuest").Visible == true then
                claim(v)
            end
        end
        
        for i,v in next, questcontent.story.Scroll:GetChildren() do
            if v and v:IsA("Frame") and v.Name ~= "Empty" and v:WaitForChild("ClaimQuest").Visible == true then
                claim(v)
            end
        end
        
        wait(5)
    end
end

function ClaimDailyReward()
    repeat
        client_to_server["claim_daily_reward"]:InvokeServer()--領每日獎勵
        wait(5)
    until PlayerGui.DailyRewards.Enabled == false
end

function code()
    local codes = {
    "GHOUL",
    "FIRSTRAIDS",
    "DATAFIX",
    "MARINEFORD",
    "TWOMILLION",
    "subtomaokuma",
    "SORRYFORSHUTDOWN",
    "TWOMILLION",
    "CHALLENGEFIXin",
    "GINYUFIX",
    "RELEASE",
    "SubToKelvingts",
    "SubToBlamspot",
    "KingLuffy",
    "TOADBOIGAMING",
    "noclypso",
    "FictioNTheFirst",
    "Cursed",
    "MUGENTRAIN",
    }
    print("------------")
    for count = 1,#codes do
        print(count)
        print(codes[count])
        local arg = codes[count]
        local Target = client_to_server["redeem_code"]
        Target:InvokeServer(arg)
    end
end



function antiAFK()
    repeat wait() until game:IsLoaded()
    spawn(function()
        while wait(60) do
            game:GetService("VirtualUser"):ClickButton2(Vector2.new())
            --print("反AFK測試腳本運行中...")
        end
    end)
    print("反AFK測試腳本已載入")
end

function tptoAFK()
    if game.placeId == 8304191830 then
        repeat wait() until client_to_server["teleport_to_time_machine"]
        while getgenv().Settings.tptoAFK do
            client_to_server["teleport_to_time_machine"]:InvokeServer()
            wait(5)
        end
    end
end

function unitsList()
    local list = {}
    for i,v in next, PlayerGui.collection.grid.List.Outer.UnitFrames:GetChildren() do
        if v:IsA("ImageButton") then
            table.insert(list,v.Name)
        end
    end
    return list
end

function GetOptionUnitsName()
    if game.placeId == 8304191830 then
        for i,v in next, PlayerGui.collection.grid.List.Outer.UnitFrames:GetChildren() do
            if v:IsA("ImageButton") then
                uuid = v:FindFirstChild("_uuid")
                if uuid and uuid:IsA("StringValue") and v.Equipped.Visible == true then
                    UnitName = v.name.Text
                    v.Name = UnitName .. ":" .. uuid.Value
                end
            end
        end
    end
end
GetOptionUnitsName()

function DeletePlaceHitbox()
    while getgenv().Settings.DeletePlaceHitbox do
        for i,v in next, game:GetService("Workspace")["_UNITS"]:GetChildren() do
            if v:FindFirstChild("_hitbox") then
                v["_hitbox"]:Destroy()
            end
        end
        wait(1)
    end
end



function CreateRecordFile()
    for i,CoreGui in next, game:GetService("CoreGui"):GetChildren() do
        if CoreGui:FindFirstChild("MainFrame") then
            for i,ScrollingFrame in next, CoreGui.MainFrame.ScrollingFrameFolder:GetChildren() do
                if ScrollingFrame:FindFirstChild("TextBoxFrame") then
                    RecordFile[ScrollingFrame.TextBoxFrame.TextBox.Text] = {}
                    RecordFileName = ScrollingFrame.TextBoxFrame.TextBox.Text
                    if RecordFileName ~= "" then
                        writefile("houkei_gui/錄製檔/" .. RecordFileName .. ".json",HttpService:JSONEncode(RecordFile))
                    end
                    RecordFile = {}
                end
            end
        end
    end
end

function Record()
    if getgenv().Settings.Record == true then
        local SelectedFile = HttpService:JSONDecode(readfile("houkei_gui/錄製檔/" .. string.sub(getgenv().Settings.SelectedRecordFile,22,-1)))
        local SelectedFileName = string.sub(getgenv().Settings.SelectedRecordFile,22,-6)
        local startTime = os.clock()
        local firstTime = true
        --[偵測放置角色
        game:GetService("Workspace")["_UNITS"].ChildAdded:Connect(function(AddedUnit)
            if AddedUnit:WaitForChild("_stats"):WaitForChild("player").Value == localplayer and AddedUnit:WaitForChild("_shadow") then
                local placeTime = os.clock() - startTime
                local unit = AddedUnit.Name
                local UUID = AddedUnit["_stats"]:WaitForChild("uuid").Value
                local CFrameValue = AddedUnit["_shadow"].CFrame

                if firstTime == true then
                    firstTime = false
                    SelectedFile[SelectedFileName] = {}
                end

                table.insert(SelectedFile[SelectedFileName],
                {
                    placeTime,
                    {
                        "Spawn",
                        {
                            Unit = unit,
                            uuid = UUID,
                            cframe = tostring(CFrameValue)
                        }
                    }
                })
                writefile("houkei_gui/錄製檔/" .. string.sub(getgenv().Settings.SelectedRecordFile,22,-1),HttpService:JSONEncode(SelectedFile))
                --[-----------------------------------------------------------------------------------------------------------------------]
                --[偵測角色升級
                local UpgradeValue = AddedUnit["_stats"]:WaitForChild("upgrade")
    
                UpgradeValue.Changed:Connect(function()
                    local UpgradeTime = os.clock() - startTime
                        
                    table.insert(SelectedFile[SelectedFileName],
                    {
                        UpgradeTime,
                        {
                            "Upgrade",
                            {
                                Name = unit,
                                Location = tostring(CFrameValue)
                            }
                        }
                    })
                    writefile("houkei_gui/錄製檔/" .. string.sub(getgenv().Settings.SelectedRecordFile,22,-1),HttpService:JSONEncode(SelectedFile))
                end)

                
                --偵測角色升級]
                local PriorityValue = AddedUnit["_stats"]:WaitForChild("priority")

                PriorityValue.Changed:Connect(function()
                    local ChangePriorityTime = os.clock() - startTime
                        
                    table.insert(SelectedFile[SelectedFileName],
                    {
                        ChangePriorityTime,
                        {
                            "ChangePriority",
                            {
                                Name = unit,
                                Location = tostring(CFrameValue)
                            }
                        }
                    })
                    writefile("houkei_gui/錄製檔/" .. string.sub(getgenv().Settings.SelectedRecordFile,22,-1),HttpService:JSONEncode(SelectedFile))
                end)
            end
        end)
        --偵測放置角色]


        -- local EndTime = os.clock() - startTime
        -- print("EndTime: " .. EndTime)
    end
end

function Playerback()
    if getgenv().Settings.Playerback == true then
        local SelectedFile = HttpService:JSONDecode(readfile("houkei_gui/錄製檔/" .. string.sub(getgenv().Settings.SelectedRecordFile,22,-1)))
        local SelectedFileName = string.sub(getgenv().Settings.SelectedRecordFile,22,-6)
        local GemFrame = PlayerGui["spawn_units"].Lives.Frame.Gem
        local GoldFrame = PlayerGui["spawn_units"].Lives.Frame.Gold
        --[[
            !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            !!!!!!!!!!!!!!!!!!!!!!!!!!!!在for i,v 裡面就要把第一個table去掉!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            !!!!!!!!!!json檔裡的cframe是「字串」要使用 stringtocframe(字串cframe) 轉換為cframe!!!!!!!!!!
            !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

            動作table的數量：
            #SelectedFile[SelectedFileName]

            動作整個table：
            SelectedFile[SelectedFileName][1]

            時間軸：
            SelectedFile[SelectedFileName][1][1]

            PlaceUnit 或 Upgrade：
            SelectedFile[SelectedFileName][1][2][1]

            uuid：
            SelectedFile[SelectedFileName][1][2][2]["uuid"]

            字串cframe：
            SelectedFile[SelectedFileName][1][2][2]["cframe"]

            cframe:
            stringtocframe(SelectedFile[SelectedFileName][1][2][2]["cframe"])

            Unit：
            SelectedFile[SelectedFileName][1][2][2]["Unit"]
        ]]
        if game.placeId ~= 8304191830 then
            GemFrame.Visible = true
            GoldFrame.Visible = true

            GemFrame.Position = UDim2.new(0.35,0,-0.6,0)
            GoldFrame.Position = UDim2.new(0.65,0,-0.6,0)

            GemFrame.Level.Text = localplayer["_stats"]["gem_amount"].Value
            GoldFrame.Level.Text = localplayer["_stats"]["gold_amount"].Value
        end


        for i,v in next, SelectedFile[SelectedFileName] do
            local Spawn = client_to_server["spawn_unit"]
            local Upgrade = client_to_server["upgrade_unit_ingame"]
            local ChangePriority = client_to_server["cycle_priority"]
            local UnitFolder = game:GetService("Workspace")["_UNITS"]
            

            local AddCFrameValue


            spawn(function()
                wait(v[1])
                if v[2][1] == "Spawn" then
                    AddCFrameValue = UnitFolder.ChildAdded:Connect(function(child)
                        if child:WaitForChild("_stats"):WaitForChild("player").Value == localplayer then
                            if child:FindFirstChild("CFrameValue") == nil then
                                local CFrameValue = Instance.new("CFrameValue")
                                CFrameValue.Name = "CFrameValue"
                                CFrameValue.Parent = child
                                CFrameValue.Value = stringtocframe(v[2][2]["cframe"])
                            end
                        end
                    end)
                    Spawn:InvokeServer(v[2][2]["uuid"], stringtocframe(v[2][2]["cframe"]))
                    AddCFrameValue:Disconnect()

                    -- if UnitFolder:WaitForChild(v[2][2]["Unit"]):WaitForChild("_shadow") then
                    --     UnitFolder:FindFirstChild(v[2][2]["Unit"])["_shadow"].CFrame = stringtocframe(v[2][2]["cframe"])
                    -- end
                elseif v[2][1] == "Upgrade" then
                    for i,unit in next, UnitFolder:GetChildren() do
                        if unit:WaitForChild("_stats"):WaitForChild("player").Value == localplayer then
                            if unit:FindFirstChild("CFrameValue").Value == stringtocframe(v[2][2]["Location"]) then

                                Upgrade:InvokeServer(unit)
                                print("升級: " .. v[2][2]["Name"])

                            end
                        end
                    end
                elseif v[2][1] == "ChangePriority" then
                    for i,unit in next, UnitFolder:GetChildren() do
                        if unit:WaitForChild("_stats"):WaitForChild("player").Value == localplayer then
                            if unit:FindFirstChild("CFrameValue").Value == stringtocframe(v[2][2]["Location"]) then
                                ChangePriority:InvokeServer(unit)
                                print("切換攻擊模式: " .. v[2][2]["Name"])

                            end
                        end
                    end
                end
            end)
        end
    end
end

function AutoToNamek()
    if game.placeId == 8304191830 then
        local elevator = "_lobbytemplategreen13"
        local level = "namek_infinite"
        local friendonly = true
        local difficulty = "Hard"

        while getgenv().Settings.AutoToNamek do
            --進電梯
            client_to_server["request_join_lobby"]:InvokeServer(elevator)
            wait(0.2)
            client_to_server["request_lock_level"]:InvokeServer(elevator, level, friendonly, difficulty)
            wait(0.2)
            client_to_server["request_start_game"]:InvokeServer(elevator)
            wait(1)
        end

    end
end

function SellUnitWave()
    repeat wait(1) until game:GetService("Workspace")["_wave_num"].Value >= tonumber(getgenv().Settings.SellUnitWave)

    local count = 0

    repeat
        for i,v in next, workspace["_UNITS"]:GetChildren() do
            v.Parent = ReplicatedStorage["_DEAD_UNITS"]
        end
        for i,v in next, ReplicatedStorage["_DEAD_UNITS"]:GetChildren() do
            client_to_server["sell_unit_ingame"]:InvokeServer(v)
        end
        wait(5)
        count = count + 1
    until count == 5
end

spawn(SellUnitWave)

function discordWebhook()
    local function getGemGoldXP(Type)
        local Value
      
        if Type == "gem" then
            Value = PlayerGui.ResultsUI.Holder.GoldGemXP.GemReward.Main.Amount.Text
        elseif Type == "gold" then
            Value = PlayerGui.ResultsUI.Holder.GoldGemXP.GoldReward.Main.Amount.Text
        elseif Type == "xp" then
            Value = PlayerGui.ResultsUI.Holder.GoldGemXP.XPReward.Main.Amount.Text
        end
      
        if Value == "+99999" then
            Value = "0"
        end
      
        return Value
    end
      
    local function getWinLose()
        local Title = PlayerGui.ResultsUI.Holder.Title.Text
        if Title == "DEFEAT" then
            Title = "戰敗"
        elseif Title == "VICTORY" then
            Title = "戰勝"
        end
        return Title
    end
      
      
        local Webhook = "https://discord.com/api/webhooks/1009476507783151697/HI1-srfBGwEeEg9PwViLzUIO6Imy9D_2fOynmGwILUSTD3B7vi5wV-dZa52yXg1I6KJe"
        local embeded = {
        ["username"] = "包莖澤GUI通知",
        ["content"] = "包莖澤小雞雞",
        ["embeds"] = {
        {
          ["author"] = {
            ["name"] = "盜版全明星塔防－結果通知",
            ["icon_url"] = "https://live.staticflickr.com/65535/52290040806_7b489b898c_o.jpg",
          },
          ["title"] = "結果日誌" .. " | " .. getWinLose(),
          ["description"] = "玩家：".. localplayer.Name,
          ["color"] = 14824689,
          ["thumbnail"] = {
            ["url"] = "https://live.staticflickr.com/65535/52290040806_7b489b898c_o.jpg",
          },
          ["fields"] = {
            {
              ["name"] = "回合：",
              ["value"] = string.match(PlayerGui.ResultsUI.Holder.Middle.WavesCompleted.Text,"%d+"),
              ["inline"] = true
            },
            {
              ["name"] = "花費時間：",
              ["value"] = string.match(PlayerGui.ResultsUI.Holder.Middle.Timer.Text,"%d+%p%d+"),
              ["inline"] = true
            },
            {
              ["name"] =  utf8.char(0020),
              ["value"] = utf8.char(0020),
              ["inline"] = true
            },
            {
              ["name"] = "鑽石：",
              ["value"] = getGemGoldXP("gem"),
              ["inline"] = true
            },
            {
              ["name"] = "金幣：",
              ["value"] = getGemGoldXP("gold"),
              ["inline"] = true
            },
            {
              ["name"] = "經驗：",
              ["value"] = getGemGoldXP("xp"),
              ["inline"] = true
            },
            {
              ["name"] = "累積鑽石：",
              ["value"] = getgenv().Settings.TotalGem,
              ["inline"] = true
            },
            {
              ["name"] = "累積金幣：",
              ["value"] = getgenv().Settings.TotalGold,
              ["inline"] = true
            },
            {
              ["name"] = "累積經驗：",
              ["value"] = getgenv().Settings.TotalXP,
              ["inline"] = true
            },
            {
              ["name"] = "目前鑽石：",
              ["value"] = localplayer["_stats"]["gem_amount"].Value,
              ["inline"] = true
            },
            {
              ["name"] = "目前金幣：",
              ["value"] = localplayer["_stats"]["gold_amount"].Value,
              ["inline"] = true
            },
            {
              ["name"] = "目前等級：",
              ["value"] = PlayerGui["spawn_units"].Lives.Main.Desc.Level.Text,
              ["inline"] = true
            },
          },
          ["footer"] = {
            ["text"] = "包莖澤GUI " .. "•" .. os.date("%Y年%m月%d日%X"),
            ["icon_url"] = "https://live.staticflickr.com/65535/52290040806_7b489b898c_o.jpg",
          },
        }
      }
      }
      local options = {
      Url = Webhook,
      Method = "POST",
      Headers = { ["Content-Type"] =  "application/json" },
      Body = game:GetService('HttpService'):JSONEncode(embeded)
      }
        
      syn.request(options)
end


function DiscordAlert()
    if game.placeId == 10098525303 then return end
    repeat wait(0.2) until PlayerGui.ResultsUI.Enabled == true
    if getgenv().Settings.DiscordAlert == true then
        local gem = string.match(PlayerGui.ResultsUI.Holder.GoldGemXP.GemReward.Main.Amount.Text,"%d+")
        local gold = string.match(PlayerGui.ResultsUI.Holder.GoldGemXP.GoldReward.Main.Amount.Text,"%d+")
        local xp = string.match(PlayerGui.ResultsUI.Holder.GoldGemXP.XPReward.Main.Amount.Text,"%d+")
        local firstTime = true
        if gem == "99999" then
            gem = "0"
        end
        if gold == "99999" then
            gold = "0"
        end
        if xp == "99999" then
            xp = "0"
        end
        getgenv().Settings.TotalGem = getgenv().Settings.TotalGem + gem
        getgenv().Settings.TotalGold = getgenv().Settings.TotalGold + gold
        getgenv().Settings.TotalXP = getgenv().Settings.TotalXP + xp
        writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
        if firstTime == true then
            firstTime = false
            discordWebhook()     
        end
    end
end


function BoostFPS()
    if game.placeId == 10098525303 then return end
    local Terrain = workspace:FindFirstChildOfClass("Terrain")
    local Lighting = game:GetService("Lighting")
    workspace:WaitForChild("_BASES"):Destroy()
    workspace:WaitForChild("_map"):Destroy()
    if workspace["_terrain"].terrain["namek dirt"] then
        workspace["_terrain"].terrain["namek dirt"]:Destroy()
    end
    --workspace["_terrain"].terrain:Destory()
    Lighting.GlobalShadows = false
    Lighting.FogEnd = 9e9
    Terrain.WaterWaveSize = 0
    Terrain.WaterWaveSpeed = 0
    Terrain.WaterReflectance = 0
    Terrain.WaterTransparency = 0

    while getgenv().Settings.BoostFPS do
        for i,v in next, workspace["_UNITS"]:GetChildren() do
            for i2,v2 in next, v:GetChildren() do
                if v2.Name == "_shadow" then
                    v2:ClearAllChildren()
                    v2.Transparency = 0.5
                end
                if v2:IsA("Model") or v2:IsA("MeshPart") or v2:IsA("Shirt") or v2:IsA("Pants") then
                    v2:Destroy()
                end
            end
            if v:WaitForChild("_stats").player.Value == nil then
                v.Parent = game:GetService("ReplicatedStorage")["_DEAD_UNITS"]
            end
        end
        wait(0.2)
    end
end
--------------------------------------函數]



local Main = library:MainFrame("盜版全明星塔防GUI")

local ingameTab = Main:Tab("遊戲內")

local lobbyTab = Main:Tab("大廳")

local recordTab = Main:Tab("錄製v0.23")

local performanceTab = Main:Tab("效能")

ingameTab:Toggle("自動升級角色",function(bool)
    getgenv().Settings.autoupgrade = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.autoupgrade then
        spawn(autoupgrade)
    end
end):Set(getgenv().Settings.autoupgrade)

ingameTab:Toggle("自動投票開始",function(bool)
    getgenv().Settings.votestart = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.votestart then
        spawn(votestart)
    end
end):Set(getgenv().Settings.votestart)


ingameTab:Toggle("自動回大廳",function(bool)
    getgenv().Settings.backtolobby = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.backtolobby then
        spawn(backtolobby)
    end
end):Set(getgenv().Settings.backtolobby)


ingameTab:Toggle("刪除放置阻擋方塊",function(bool)
    getgenv().Settings.DeletePlaceHitbox = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.DeletePlaceHitbox then
        spawn(DeletePlaceHitbox)
    end
end):Set(getgenv().Settings.DeletePlaceHitbox)

---------------------------------------------------------------------------------------------

lobbyTab:Tag("傳送")

lobbyTab:Toggle("傳送至掛機區",function(bool)
    getgenv().Settings.tptoAFK = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.tptoAFK then
        spawn(tptoAFK)
    end
end):Set(getgenv().Settings.tptoAFK)

lobbyTab:Toggle("自動傳送「滷蛋頭無限」",function(bool)
    getgenv().Settings.AutoToNamek = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.AutoToNamek then
        spawn(AutoToNamek)
    end
end):Set(getgenv().Settings.AutoToNamek)

lobbyTab:Slider("賣掉全角色的回合",1,250,function(arg)
    getgenv().Settings.SellUnitWave = arg
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))  
end):Set(getgenv().Settings.SellUnitWave)

--[[---------------------------------]]lobbyTab:Line()--[[---------------------------------]]

lobbyTab:Toggle("反掛機踢出",function(bool)
    getgenv().Settings.antiAFK = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.antiAFK then
        spawn(antiAFK)
    end
end):Set(getgenv().Settings.antiAFK)

lobbyTab:Toggle("自動領取任務獎勵",function(bool)
    getgenv().Settings.ClaimQuest = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.ClaimQuest then
        spawn(ClaimQuest)
    end
end):Set(getgenv().Settings.ClaimQuest)

lobbyTab:Toggle("自動領取每日獎勵(Bug)",function(bool)
    getgenv().Settings.ClaimDailyReward = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.ClaimDailyReward then
        spawn(ClaimDailyReward)
    end
end):Set(getgenv().Settings.ClaimDailyReward)

--[[---------------------------------]]lobbyTab:Line()--[[---------------------------------]]

lobbyTab:Button("兌換代碼",function()
    code()
end)

---------------------------------------------------------------------------------------------

recordTab:Dropdown("選擇檔案",getgenv().RecordFileList,function(SelectedButton)
    print(SelectedButton)
    getgenv().Settings.SelectedRecordFile = SelectedButton
    print(getgenv().Settings.SelectedRecordFile)
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
end):Set(getgenv().Settings.SelectedRecordFile)

recordTab:Toggle("回放",function(bool)
    getgenv().Settings.Playerback = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.Playerback then
        spawn(Playerback)
    end
end):Set(getgenv().Settings.Playerback)



recordTab:Toggle("Discord結果通知",function(bool)
    getgenv().Settings.DiscordAlert = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.DiscordAlert and FirstDiscordAlert == true then
        FirstDiscordAlert = false
        spawn(DiscordAlert)
    else
        getgenv().Settings.TotalGem = 0
        getgenv().Settings.TotalGold = 0
        getgenv().Settings.TotalXP = 0
        writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    end
end):Set(getgenv().Settings.DiscordAlert)

recordTab:TextBox("錄製檔名稱")

recordTab:Button("創建錄製檔",function()
    spawn(CreateRecordFile)
end)


--[[---------------------------------]]recordTab:Line()--[[---------------------------------]]

recordTab:Toggle("錄製",function(bool)
    getgenv().Settings.Record = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.Record then
        spawn(Record)
    end
end):Set(getgenv().Settings.Record)

-- recordTab:Tag("欄位一：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit1[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit1[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit1[1] .. ":" .. getgenv().Settings.unit1[2])

-- recordTab:Tag("欄位二：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit2[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit2[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit2[1] .. ":" .. getgenv().Settings.unit2[2])

-- recordTab:Tag("欄位三：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit3[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit3[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit3[1] .. ":" .. getgenv().Settings.unit3[2])

-- recordTab:Tag("欄位四：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit4[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit4[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit4[1] .. ":" .. getgenv().Settings.unit4[2])

-- recordTab:Tag("欄位五：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit5[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit5[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit5[1] .. ":" .. getgenv().Settings.unit5[2])

-- recordTab:Tag("欄位六：")

-- recordTab:Dropdown("選角色",unitsList(),function(SelectedButton)
--     getgenv().Settings.unit6[1] = SelectedButton["name"].Text
--     getgenv().Settings.unit6[2] = SelectedButton["_uuid"].Value
--     writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
-- end):Set(getgenv().Settings.unit6[1] .. ":" .. getgenv().Settings.unit6[2])

performanceTab:Tag("降低CPU使用率")

performanceTab:Toggle("刪除場景、角色物件",function(bool)
    getgenv().Settings.BoostFPS = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.BoostFPS then
        spawn(BoostFPS)
    end
end):Set(getgenv().Settings.BoostFPS)

performanceTab:Toggle("關閉3D渲染",function(bool)
    local WindowFocused
    local WindowFocusReleased
    getgenv().Settings.WindowFocus = bool
    writefile(settingdata,HttpService:JSONEncode(getgenv().Settings))
    if getgenv().Settings.WindowFocus then
        -- local RENDER = true
        -- local UserInputService = game:GetService("UserInputService")
        local RunService = game:GetService("RunService")
        RunService:Set3dRenderingEnabled(false)
    else
        local RunService = game:GetService("RunService")
        RunService:Set3dRenderingEnabled(true)
        -- WindowFocused = UserInputService.WindowFocused:Connect(function()
        --     if RENDER then
        --         RunService:Set3dRenderingEnabled(true)
        --     end
        -- end)

        -- WindowFocusReleased = UserInputService.WindowFocusReleased:Connect(function()
        --     if RENDER then
        --         RunService:Set3dRenderingEnabled(false)
        --     end
        -- end)
    end
end):Set(getgenv().Settings.WindowFocus)